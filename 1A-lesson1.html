<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1A-1-—Ä —Ö–∏—á—ç—ç–ª ¬∑ “Æ–≥–∏–π–Ω —Å–∞–Ω–≥–∏–π–Ω —Ç–µ—Å—Ç</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background-color: #f0f4f8; padding: 20px; color: #333; }
    .container { max-width: 520px; margin: 0 auto; background: white; padding: 26px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
    h2 { color: #2c3e50; font-size: 22px; margin-top: 0; }
    input { width: 90%; padding: 14px; margin: 14px 0; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 18px; text-align: center; }
    button { background-color: #3498db; color: white; padding: 15px 16px; border: none; border-radius: 10px; cursor: pointer; font-size: 18px; font-weight: bold; width: 100%; transition: 0.2s; }
    button:hover { background-color: #2980b9; }
    .choice-btn {
      display: block; width: 100%; margin: 12px 0;
      background-color: #ffffff; color: #333; text-align: center;
      border: 2px solid #3498db; padding: 15px; font-size: 18px; border-radius: 10px;
    }
    .choice-btn:hover { background-color: #3498db; color: white; }
    #quiz-section, #result-section, #review-section { display: none; }
    .wrong-list { text-align: left; background: #fff5f5; padding: 15px; border-radius: 10px; margin: 18px 0; border: 1px solid #feb2b2; max-height: 320px; overflow-y: auto; }
    .wrong-item { margin-bottom: 10px; font-size: 16px; border-bottom: 1px dashed #feb2b2; padding-bottom: 6px; }
    .score-text { font-size: 24px; font-weight: bold; color: #e74c3c; margin: 10px 0; }
    .instruction { font-size: 15px; color: #666; margin-bottom: 14px; background: #eef2f7; padding: 10px; border-radius: 8px; }
    .meta { font-size: 13px; color: #7f8c8d; margin-top: 6px; }
    .note {
      margin-top: 14px;
      background: #eaf3ff;
      border: 1px solid #b9d7ff;
      border-radius: 10px;
      padding: 12px;
      color: #0f3f7a;
      font-weight: 800;
      line-height: 1.4;
    }
    .row { display:flex; gap:10px; margin-top:12px; }
    .row button { width: 50%; }
    .btn-orange { background-color: #e67e22; }
    .btn-orange:hover { background-color: #cf6b12; }
    .btn-gray { background-color: #eef2f7; color:#2c3e50; border:1px solid #d7dee7; }
    .btn-gray:hover { background-color: #e2e8f0; }
  </style>
</head>
<body>
  <div class="container">
    <div id="start-section">
      <h2>1A: 1-—Ä —Ö–∏—á—ç—ç–ª<br>“Æ–≥—Å–∏–π–Ω —Å–∞–Ω–≥–∏–π–Ω —Ç–µ—Å—Ç</h2>
      <p style="color:#7f8c8d; margin: 6px 0 0;">–ù—ç—Ä—ç—ç –æ—Ä—É—É–ª–∞–∞–¥ —ç—Ö—ç–ª–Ω—ç “Ø“Ø.</p>
      <input type="text" id="userName" placeholder="–¢–∞–Ω—ã –Ω—ç—Ä" autocomplete="name" />
      <button id="startBtn" onclick="startQuiz()">–≠—Ö–ª—ç—Ö</button>
      <div class="meta" id="vocabCount"></div>
    </div>

    <div id="quiz-section">
      <h3 id="question-number" style="color:#3498db; margin: 0;"></h3>
      <p id="question-instruction" class="instruction"></p>
      <p id="question-text" style="font-size:32px; font-weight:bold; margin: 18px 0; color:#2c3e50;"></p>
      <div id="choices"></div>
      <div class="row">
        <button class="btn-gray" onclick="goHome()">–≠—Ö–ª—ç–ª</button>
        <button class="btn-gray" onclick="restartAttempt()">–î–∞—Ö–∏–Ω —ç—Ö–ª—ç—Ö</button>
      </div>
    </div>

    <div id="review-section">
      <h2 style="color:#e67e22;">–ê–ª–¥–∞–∞–≥–∞–∞ —à–∞–ª–≥–∞–Ω–∞ —É—É</h2>
      <p style="margin-top: 6px;">–≠–¥–≥—ç—ç—Ä “Ø–≥—Å–∏–π–≥ —Ü—ç—ç–∂–ª—ç—ç–¥ –¥–∞—Ö–∏–Ω –æ—Ä–æ–ª–¥–æ–Ω–æ —É—É.</p>
      <div id="wrong-answers-container" class="wrong-list"></div>
      <button class="btn-orange" onclick="retryQuiz()">–û–π–ª–≥–æ–ª–æ–æ, –¥–∞—Ö–∏–Ω —ç—Ö–ª—ç—Ö</button>
      <div class="meta" id="attemptMetaReview"></div>
    </div>

    <div id="result-section">
      <h2 id="result-title" style="color:#27ae60;">üéâ –¢—ç–Ω—Ü–ª—ç—ç!</h2>
      <div id="result-content">
        <p id="result-msg" style="font-size:18px; line-height: 1.8; margin: 16px 0;"></p>
        <div class="note">–≠–Ω—ç –¥—ç–ª–≥—ç—Ü–∏–π–≥ —Å–∫—Ä–∏–Ω—à–æ—Ç —Ö–∏–π–∂ –±–∞–≥—à —Ä—É—É–≥–∞–∞ –∏–ª–≥—ç—ç–Ω—ç “Ø“Ø!</div>
        <div class="row">
          <button onclick="restartAttempt()">–î–∞—Ö–∏–Ω —Ö–∏–π—Ö</button>
          <button class="btn-gray" onclick="resetAll()">–®–∏–Ω—ç –Ω—ç—Ä—ç—ç—Ä</button>
        </div>
      </div>
    </div>
  </div>

<script>
  // Îã®Ïñ¥ Îç∞Ïù¥ÌÑ∞ (ÏßàÎ¨∏/Î≥¥Í∏∞ ÍµêÏ∞®: kor‚Üímon / mon‚Üíkor)
  // Ï≤†Ïûê 1Í≥≥ ÏàòÏ†ï: "ÎÖ∏–º—ã–Ω —Å–∞–Ω" -> "–Ω–æ–º—ã–Ω —Å–∞–Ω"
  const rawWords = [
    { kor: "Í≥µÌï≠", mon: "–Ω–∏—Å—ç—Ö –æ–Ω–≥–æ—Ü–Ω—ã –±—É—É–¥–∞–ª", pos: "n" },
    { kor: "ÏãúÏû•", mon: "–∑–∞—Ö", pos: "n" },
    { kor: "Í∞ÄÎã§", mon: "—è–≤–∞—Ö", pos: "v" },
    { kor: "ÏòÅÍµ≠", mon: "–ë—Ä–∏—Ç–∞–Ω", pos: "n" },
    { kor: "Ï±ÖÏÉÅ", mon: "—à–∏—Ä—ç—ç", pos: "n" },
    { kor: "ÌïôÍµê", mon: "—Å—É—Ä–≥—É—É–ª—å", pos: "n" },
    { kor: "ÎßàÏãúÎã§", mon: "—É—É—Ö", pos: "v" },
    { kor: "Î®πÎã§", mon: "–∏–¥—ç—Ö", pos: "v" },
    { kor: "Ï£ºÏä§", mon: "–∂“Ø“Ø—Å", pos: "n" },
    { kor: "Ìò∏Ï£º", mon: "–ê–≤—Å—Ç—Ä–∞–ª–∏", pos: "n" },
    { kor: "Ïßë", mon: "–≥—ç—Ä", pos: "n" },
    { kor: "ÏùòÏÇ¨", mon: "—ç–º—á", pos: "n" },
    { kor: "ÎØ∏Íµ≠", mon: "–ê–º–µ—Ä–∏–∫", pos: "n" },
    { kor: "ÌöåÏÇ¨Ïõê", mon: "–∫–æ–º–ø–∞–Ω–∏–π–Ω –∞–∂–∏–ª—Ç–∞–Ω", pos: "n" },
    { kor: "ÏÇ¨Îã§", mon: "—Ö—É–¥–∞–ª–¥–∞–∂ –∞–≤–∞—Ö", pos: "v" },
    { kor: "ÌîÑÎûëÏä§", mon: "–§—Ä–∞–Ω—Ü", pos: "n" },
    { kor: "Ïò§Îã§", mon: "–∏—Ä—ç—Ö", pos: "v" },
    { kor: "ÌîºÏûê", mon: "–ø–∏—Ü—Ü–∞", pos: "n" },
    { kor: "ÎèÑÏÑúÍ¥Ä", mon: "–Ω–æ–º—ã–Ω —Å–∞–Ω", pos: "n" },
    { kor: "Î™ΩÍ≥®", mon: "–ú–æ–Ω–≥–æ–ª", pos: "n" },
    { kor: "ÏùΩÎã§", mon: "—É–Ω—à–∏—Ö", pos: "v" },
    { kor: "ÌïúÍµ≠", mon: "–°–æ–ª–æ–Ω–≥–æ—Å", pos: "n" },
    { kor: "ÏÑ†ÏÉùÎãò", mon: "–±–∞–≥—à", pos: "n" },
    { kor: "Í∏∞Ïûê", mon: "—Å—ç—Ç–≥“Ø“Ø–ª—á", pos: "n" },
    { kor: "ÏãùÎãπ", mon: "—Ö–æ–æ–ª–Ω—ã –≥–∞–∑–∞—Ä", pos: "n" },
    { kor: "ÏöîÎ¶¨ÏÇ¨", mon: "—Ç–æ–≥–æ–æ—á", pos: "n" },
    { kor: "ÏöîÎ¶¨ÌïòÎã§", mon: "—Ö–æ–æ–ª —Ö–∏–π—Ö", pos: "v" },
    { kor: "Ï£ºÎã§", mon: "”©–≥”©—Ö", pos: "v" },
    { kor: "Ï§ëÍµ≠", mon: "–•—è—Ç–∞–¥", pos: "n" },
    { kor: "ÏÇ¨Îûå", mon: "—Ö“Ø–Ω", pos: "n" },
    { kor: "ÏùºÎ≥∏", mon: "–Ø–ø–æ–Ω", pos: "n" },
    { kor: "Íµ∞Ïù∏", mon: "—Ü—ç—Ä—ç–≥", pos: "n" },
    { kor: "Í∞ÄÏàò", mon: "–¥—É—É—á–∏–Ω", pos: "n" },
    { kor: "Ïñ¥Îäê", mon: "–∞–ª—å", pos: "o" },
    { kor: "ÏùòÏûê", mon: "—Å–∞–Ω–¥–∞–ª", pos: "n" },
    { kor: "Ïö¥ÎèôÌïòÎã§", mon: "–¥–∞—Å–≥–∞–ª —Ö–∏–π—Ö", pos: "v" },
    { kor: "ÎßàÌä∏", mon: "–¥—ç–ª–≥“Ø“Ø—Ä", pos: "n" },
    { kor: "ÌïôÏÉù", mon: "–æ—é—É—Ç–∞–Ω", pos: "n" },
    { kor: "Î∞±ÌôîÏ†ê", mon: "–∏—Ö –¥—ç–ª–≥“Ø“Ø—Ä", pos: "n" },
    { kor: "ÎèÖÏùº", mon: "–ì–µ—Ä–º–∞–Ω", pos: "n" }
  ];

  // ÏÉÅÌÉúÍ∞í
  let wordList = [];
  let currentIdx = 0;
  let score = 0;
  let wrongWords = [];
  let name = "";

  // ÏãúÎèÑ ÌöüÏàò (Î°úÏª¨ Ï†ÄÏû•)
  const STORE_KEY = "attempts_1A1";
  let attempts = localStorage.getItem(STORE_KEY) ? parseInt(localStorage.getItem(STORE_KEY), 10) : 0;

  // ÏÑ§Ï†ï
  const PASS_SCORE = 80;
  const MAX_FAILS_BEFORE_PASS = 5;

  // Ï¥àÍ∏∞ ÌëúÏãú
  document.getElementById("vocabCount").innerText = `“Æ–≥–∏–π–Ω —Ç–æ–æ: ${rawWords.length}`;
  document.getElementById("userName").addEventListener("keydown", (e) => {
    if (e.key === "Enter") startQuiz();
  });

  // Ïú†Ìã∏
  function shuffle(arr){
    const a = arr.slice();
    for (let i=a.length-1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function unique(arr){
    const seen = new Set();
    const out = [];
    for (const x of arr){
      if (!seen.has(x)){
        seen.add(x);
        out.push(x);
      }
    }
    return out;
  }

  // ÌïµÏã¨: Í∞ôÏùÄ ÌíàÏÇ¨ Ïö∞ÏÑ† Ïò§Îãµ 3Í∞ú ÏÉùÏÑ± + Ï§ëÎ≥µ Î∞©ÏßÄ + Ìï≠ÏÉÅ 4ÏßÄ Ïú†ÏßÄ
  function buildChoices(correctAnswer, type, pos){
    // type: "kor"(ÏßàÎ¨∏Ïù¥ ÌïúÍµ≠Ïñ¥) => Î≥¥Í∏∞ Î™ΩÍ≥®Ïñ¥, "mon"(ÏßàÎ¨∏Ïù¥ Î™ΩÍ≥®Ïñ¥) => Î≥¥Í∏∞ ÌïúÍµ≠Ïñ¥
    const getVal = (w) => (type === "kor" ? w.mon : w.kor);

    const samePos = rawWords.filter(w => w.pos === pos).map(getVal).filter(v => v && v !== correctAnswer);
    const anyPos  = rawWords.map(getVal).filter(v => v && v !== correctAnswer);

    let distractors = [];
    if (pos === "o") {
      // 'Ïñ¥Îäê/–∞–ª—å' Í∞ôÏùÄ Í≤ΩÏö∞ Ï†ÑÏ≤¥ÏóêÏÑú Í≥†Î•¥Í≤å
      distractors = shuffle(anyPos);
    } else {
      // Í∞ôÏùÄ ÌíàÏÇ¨ Ïö∞ÏÑ†
      distractors = shuffle(samePos).concat(shuffle(anyPos));
    }

    const picked = [];
    for (const d of distractors){
      if (d !== correctAnswer && !picked.includes(d)) picked.push(d);
      if (picked.length >= 3) break;
    }

    const choices = unique([correctAnswer, ...picked]);
    // ÌòπÏãúÎùºÎèÑ 4Í∞ú ÎØ∏ÎßåÏù¥Î©¥(Îç∞Ïù¥ÌÑ∞ Ï§ëÎ≥µ Îì±) Ï†ÑÏ≤¥ ÌíÄÏóêÏÑú Ï∂îÍ∞ÄÎ°ú Ï±ÑÏõÄ
    if (choices.length < 4){
      for (const d of shuffle(anyPos)){
        if (!choices.includes(d)) choices.push(d);
        if (choices.length >= 4) break;
      }
    }

    return shuffle(choices.slice(0,4));
  }

  function prepareQuestions() {
    const shuffled = shuffle(rawWords);
    wordList = shuffled.map((w) => {
      const isKorQuestion = Math.random() < 0.5;
      const q = isKorQuestion ? w.kor : w.mon;
      const a = isKorQuestion ? w.mon : w.kor;
      const type = isKorQuestion ? "kor" : "mon";

      const choices = buildChoices(a, type, w.pos);

      return { q, a, type, pos: w.pos, choices };
    });
  }

  function startQuiz() {
    name = (document.getElementById("userName").value || "").trim();
    if (!name) { alert("–ù—ç—Ä—ç—ç –æ—Ä—É—É–ª–Ω–∞ —É—É!"); return; }

    attempts = localStorage.getItem(STORE_KEY) ? parseInt(localStorage.getItem(STORE_KEY), 10) : attempts;
    currentIdx = 0;
    score = 0;
    wrongWords = [];

    prepareQuestions();
    document.getElementById("start-section").style.display = "none";
    document.getElementById("review-section").style.display = "none";
    document.getElementById("result-section").style.display = "none";
    document.getElementById("quiz-section").style.display = "block";
    showQuestion();
  }

  function showQuestion() {
    if (currentIdx < wordList.length) {
      const item = wordList[currentIdx];

      document.getElementById("question-number").innerText = `${currentIdx + 1} / ${wordList.length}`;
      document.getElementById("question-instruction").innerText =
        item.type === "kor" ? "–ó”©–≤ –ú–æ–Ω–≥–æ–ª –æ—Ä—á—É—É–ª–≥—ã–≥ —Å–æ–Ω–≥–æ–Ω–æ —É—É." : "–ó”©–≤ –°–æ–ª–æ–Ω–≥–æ—Å “Ø–≥–∏–π–≥ —Å–æ–Ω–≥–æ–Ω–æ —É—É.";
      document.getElementById("question-text").innerText = item.q;

      const choicesDiv = document.getElementById("choices");
      choicesDiv.innerHTML = "";

      // Ïó∞ÏÜç ÌÅ¥Î¶≠ Î∞©ÏßÄ
      let locked = false;

      item.choices.forEach((c) => {
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.innerText = c;
        btn.onclick = () => {
          if (locked) return;
          locked = true;
          checkAnswer(c);
        };
        choicesDiv.appendChild(btn);
      });
    } else {
      finishQuiz();
    }
  }

  function checkAnswer(answer) {
    const item = wordList[currentIdx];
    if (answer === item.a) {
      score += (100 / wordList.length);
    } else {
      wrongWords.push(item); // {q, a} ÌòïÌÉú Í∑∏ÎåÄÎ°ú Ï†ÄÏû•
    }
    currentIdx++;
    showQuestion();
  }

  function finishQuiz() {
    attempts++;
    localStorage.setItem(STORE_KEY, String(attempts));

    const finalScore = Math.round(score);

    if (finalScore >= PASS_SCORE || attempts >= MAX_FAILS_BEFORE_PASS) {
      document.getElementById("quiz-section").style.display = "none";
      document.getElementById("review-section").style.display = "none";
      document.getElementById("result-section").style.display = "block";

      const forced = (attempts >= MAX_FAILS_BEFORE_PASS && finalScore < PASS_SCORE);
      document.getElementById("result-title").innerText = forced ? "üí™ –¢—ç–Ω—Ü–ª—ç—ç!" : "üéâ –¢—ç–Ω—Ü–ª—ç—ç!";

      document.getElementById("result-msg").innerHTML =
        `<b>${name}</b><br>` +
        (forced ? `–¢–∞ –æ–ª–æ–Ω —É–¥–∞–∞ —Ö–∏—á—ç—ç–ª–ª—ç—Å—ç–Ω —Ç—É–ª —É—Ä–∞–º—à—É—É–ª–∂ —Ç—ç–Ω—Ü“Ø“Ø–ª–ª—ç—ç.<br>` : `–ë–∞—è—Ä —Ö“Ø—Ä–≥—ç–µ! –¢–∞ —Ç—ç–Ω—Ü–ª—ç—ç.<br>`) +
        `<span class="score-text">–î“Ø–Ω: ${finalScore} –æ–Ω–æ–æ</span><br>` +
        `–û—Ä–æ–ª–¥–ª–æ–≥–æ: ${attempts}`;

      // ÌÜµÍ≥º ÌõÑ ÏãúÎèÑÌöüÏàò Ï¥àÍ∏∞Ìôî
      localStorage.removeItem(STORE_KEY);
      attempts = 0;

    } else {
      showReview(finalScore);
    }
  }

  function showReview(finalScore) {
    document.getElementById("quiz-section").style.display = "none";
    document.getElementById("result-section").style.display = "none";
    document.getElementById("review-section").style.display = "block";

    document.getElementById("attemptMetaReview").innerText =
      `–û—Ä–æ–ª–¥–ª–æ–≥–æ: ${attempts} / ${MAX_FAILS_BEFORE_PASS}`;

    const container = document.getElementById("wrong-answers-container");
    container.innerHTML = `<p style="font-weight:900; color:#e74c3c;">–¢–∞–Ω—ã –¥“Ø–Ω: ${finalScore} –æ–Ω–æ–æ</p>`;

    wrongWords.forEach(w => {
      const div = document.createElement("div");
      div.className = "wrong-item";
      // w.q = ÌãÄÎ¶∞ ÏßàÎ¨∏(ÌïúÍµ≠Ïñ¥ or Î™ΩÍ≥®Ïñ¥), w.a = Ï†ïÎãµ(Î∞òÎåÄ Ïñ∏Ïñ¥)
      div.innerHTML = `‚ùì <b>${w.q}</b> ‚Üí ‚úÖ –ó”©–≤: <b>${w.a}</b>`;
      container.appendChild(div);
    });
  }

  function retryQuiz() {
    currentIdx = 0;
    score = 0;
    wrongWords = [];
    prepareQuestions();
    document.getElementById("review-section").style.display = "none";
    document.getElementById("quiz-section").style.display = "block";
    showQuestion();
  }

  function restartAttempt(){
    // Í∞ôÏùÄ Ïù¥Î¶ÑÏúºÎ°ú 1ÌöåÏ∞® Îã§Ïãú ÏãúÏûë (ÏãúÎèÑÌöüÏàòÎäî Ïú†ÏßÄ)
    currentIdx = 0;
    score = 0;
    wrongWords = [];
    prepareQuestions();
    document.getElementById("start-section").style.display = "none";
    document.getElementById("review-section").style.display = "none";
    document.getElementById("result-section").style.display = "none";
    document.getElementById("quiz-section").style.display = "block";
    showQuestion();
  }

  function goHome(){
    document.getElementById("quiz-section").style.display = "none";
    document.getElementById("review-section").style.display = "none";
    document.getElementById("result-section").style.display = "none";
    document.getElementById("start-section").style.display = "block";
  }

  function resetAll(){
    // ÏÉà Ïù¥Î¶ÑÏúºÎ°ú ÏãúÏûë + ÏãúÎèÑÌöüÏàò Ï¥àÍ∏∞Ìôî
    localStorage.removeItem(STORE_KEY);
    attempts = 0;
    currentIdx = 0;
    score = 0;
    wrongWords = [];
    name = "";
    document.getElementById("userName").value = "";
    goHome();
  }
</script>
</body>
</html>
