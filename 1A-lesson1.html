<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ‚úÖ Ï∫êÏãú ÏòÅÌñ• ÏµúÏÜåÌôî(Í∏∞Í∏∞ÎßàÎã§ Îã§Î•∏ Î≤ÑÏ†Ñ Îú®Îäî Î¨∏Ï†ú ÏòàÎ∞©) -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <title>1A-1-—Ä —Ö–∏—á—ç—ç–ª ¬∑ “Æ–≥–∏–π–Ω —Å–∞–Ω–≥–∏–π–Ω —Ç–µ—Å—Ç (–¢–æ–≥—Ç–≤–æ—Ä—Ç–æ–π)</title>

  <style>
    :root{
      --bg:#f0f4f8; --card:#fff; --primary:#2d6cdf; --primary2:#1f4ea5;
      --text:#223047; --muted:#6a7a8e; --line:#d9e4f5;
      --warnbg:#fff5f5; --warnline:#feb2b2;
    }
    *{box-sizing:border-box}
    body{margin:0; padding:20px; font-family:Arial,sans-serif; background:var(--bg); color:var(--text); text-align:center;}
    .container{max-width:560px; margin:0 auto; background:var(--card); padding:26px; border-radius:20px; border:1px solid var(--line); box-shadow:0 10px 20px rgba(0,0,0,0.08);}
    h2{margin:0; font-size:22px; color:#1f2f45;}
    .sub{margin:10px 0 0; color:var(--muted); font-size:15px;}
    input{width:92%; padding:14px; margin:14px 0 10px; border:2px solid #e0e0e0; border-radius:12px; font-size:18px; text-align:center; outline:none;}
    input:focus{border-color:#b7cdfd; box-shadow:0 0 0 4px rgba(45,108,223,0.12);}
    button{width:100%; background:var(--primary); color:#fff; padding:15px 16px; border:none; border-radius:12px; cursor:pointer; font-size:18px; font-weight:900; transition:.2s;}
    button:hover{background:var(--primary2);}
    .choice-btn{display:block; width:100%; margin:12px 0; background:#fff; color:var(--text); border:2px solid var(--primary); border-radius:12px; padding:15px; font-size:18px; font-weight:900; cursor:pointer; transition:.15s;}
    .choice-btn:hover{background:var(--primary); color:#fff;}
    .row{display:flex; gap:10px; margin-top:12px;}
    .row button{width:50%;}
    .btn-gray{background:#eef2f7; color:#2c3e50; border:1px solid #d7dee7;}
    .btn-gray:hover{background:#e2e8f0;}
    .btn-orange{background:#e67e22;}
    .btn-orange:hover{background:#cf6b12;}
    .tag{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #d7dee7; background:#f6f9ff; font-size:12px; color:#2c3e50; font-weight:900;}
    .instruction{margin:14px 0 12px; background:#eef2f7; border-radius:10px; padding:10px; color:#4b5b6f; font-size:14px; line-height:1.35;}
    .qtext{font-size:34px; font-weight:1000; margin:16px 0 10px; color:#1e2f44; word-break:break-word;}
    .meta{color:var(--muted); font-size:13px; margin-top:8px;}
    .box-warn{text-align:left; margin-top:14px; background:var(--warnbg); border:1px solid var(--warnline); border-radius:12px; padding:12px; color:#7a1f1f; font-size:14px; line-height:1.45;}
    .wrong-list{text-align:left; background:var(--warnbg); padding:15px; border-radius:12px; margin:18px 0; border:1px solid var(--warnline); max-height:340px; overflow-y:auto;}
    .wrong-item{margin-bottom:10px; border-bottom:1px dashed var(--warnline); padding-bottom:8px; font-size:15px;}
    .score-text{font-size:24px; font-weight:1000; color:#d33; margin:10px 0;}
    .note{margin-top:14px; background:#eaf3ff; border:1px solid #b9d7ff; border-radius:12px; padding:12px; color:#0f3f7a; font-weight:1000; line-height:1.4;}
    .result-card{text-align:left; border:1px solid var(--line); border-radius:14px; padding:14px; background:#fff;}
    .result-card .title{font-size:16px; font-weight:1000; color:#1f2f45; margin-bottom:8px;}
    .result-card .line{font-size:15px; line-height:1.6; color:#223047;}
    .result-card .small{font-size:13px; color:var(--muted); margin-top:8px; font-weight:900;}
    #quiz-section,#review-section,#result-section,#error-section{display:none;}
  </style>
</head>
<body>
  <div class="container">
    <div id="start-section">
      <h2>1A: 1-—Ä —Ö–∏—á—ç—ç–ª<br>“Æ–≥—Å–∏–π–Ω —Å–∞–Ω–≥–∏–π–Ω —Ç–µ—Å—Ç</h2>
      <p class="sub">–ù—ç—Ä—ç—ç –æ—Ä—É—É–ª–∞–∞–¥ —ç—Ö—ç–ª–Ω—ç “Ø“Ø.</p>
      <input id="userName" type="text" placeholder="–¢–∞–Ω—ã –Ω—ç—Ä" autocomplete="name" />
      <button onclick="startQuiz()">–≠—Ö–ª—ç—Ö</button>
      <div class="meta" id="vocabCount"></div>
    </div>

    <div id="error-section">
      <h2 style="color:#b3261e;">–ê–ª–¥–∞–∞ (”®–≥”©–≥–¥”©–ª)</h2>
      <p class="sub">“Æ–≥–∏–π–Ω –∂–∞–≥—Å–∞–∞–ª—Ç–∞–¥ —Ö—ç–ª–Ω–∏–π —Ç—ç–º–¥—ç–≥—Ç —Ö–æ–ª–∏–ª–¥—Å–æ–Ω –±–∞–π–Ω–∞.</p>
      <div class="box-warn" id="errorDetail"></div>
      <div class="row">
        <button class="btn-gray" onclick="goHome()">–≠—Ö–ª—ç–ª</button>
        <button class="btn-gray" onclick="showDataHint()">–ñ–∏—à—ç—ç</button>
      </div>
      <div class="box-warn" id="dataHint" style="display:none;"></div>
    </div>

    <div id="quiz-section">
      <h3 id="question-number" style="color:var(--primary); margin:0;"></h3>
      <div id="question-instruction" class="instruction"></div>
      <div id="question-text" class="qtext"></div>
      <div id="choices"></div>
      <div class="row">
        <button class="btn-gray" onclick="goHome()">–≠—Ö–ª—ç–ª</button>
        <button class="btn-gray" onclick="restartAttempt()">–î–∞—Ö–∏–Ω —ç—Ö–ª—ç—Ö</button>
      </div>
      <div class="meta" id="attemptMetaQuiz"></div>
    </div>

    <div id="review-section">
      <h2 style="color:#e67e22;">–ê–ª–¥–∞–∞–≥–∞–∞ —à–∞–ª–≥–∞–Ω–∞ —É—É</h2>
      <p class="sub">–≠–¥–≥—ç—ç—Ä “Ø–≥—Å–∏–π–≥ —Ü—ç—ç–∂–ª—ç—ç–¥ –¥–∞—Ö–∏–Ω –æ—Ä–æ–ª–¥–æ–Ω–æ —É—É.</p>
      <div id="wrong-answers-container" class="wrong-list"></div>
      <button class="btn-orange" onclick="retryQuiz()">–û–π–ª–≥–æ–ª–æ–æ, –¥–∞—Ö–∏–Ω —ç—Ö–ª—ç—Ö</button>
      <div class="meta" id="attemptMetaReview"></div>
    </div>

    <div id="result-section">
      <h2 id="result-title" style="color:#1f8a4b;">üéâ –¢—ç–Ω—Ü–ª—ç—ç!</h2>

      <div id="captureTarget" class="result-card">
        <div class="title">“Æ—Ä –¥“Ø–Ω</div>
        <div class="line" id="resultLineName"></div>
        <div class="line" id="resultLineScore"></div>
        <div class="line" id="resultLineAttempts"></div>
        <div class="small">–≠–Ω—ç –¥—ç–ª–≥—ç—Ü–∏–π–≥ —Å–∫—Ä–∏–Ω—à–æ—Ç —Ö–∏–π–∂ –±–∞–≥—à —Ä—É—É–≥–∞–∞ –∏–ª–≥—ç—ç–Ω—ç “Ø“Ø!</div>
      </div>

      <div class="note">–î–æ–æ—Ä—Ö —Ç–æ–≤—á–∏–π–≥ –¥–∞—Ä–∂ “Ø—Ä –¥“Ø–Ω–≥—ç—ç –∑—É—Ä–∞–≥ –±–æ–ª–≥–æ–Ω —Ö–∞–¥–≥–∞–ª–∞–∞–¥ –±–∞–≥—à–¥–∞–∞ —è–≤—É—É–ª–Ω–∞ —É—É.</div>

      <div class="row">
        <button onclick="captureResultCard()">üì∏ –ó—É—Ä–∞–≥ –±–æ–ª–≥–æ–Ω —Ö–∞–¥–≥–∞–ª–∞—Ö</button>
        <button class="btn-gray" onclick="restartAttempt()">–î–∞—Ö–∏–Ω —Ö–∏–π—Ö</button>
      </div>
      <div class="row">
        <button class="btn-gray" onclick="resetAll()">–®–∏–Ω—ç –Ω—ç—Ä—ç—ç—Ä</button>
        <button class="btn-gray" onclick="goHome()">–≠—Ö–ª—ç–ª</button>
      </div>

      <div class="meta" id="captureStatus"></div>
    </div>
  </div>

<script>
  /***************
   * 1Í≥º Ïñ¥Ìúò Îç∞Ïù¥ÌÑ∞(Ï†ïÏÉÅÎ≥∏)
   ***************/
  const rawWords = [
    { kor: "Í≥µÌï≠", mon: "–Ω–∏—Å—ç—Ö –æ–Ω–≥–æ—Ü–Ω—ã –±—É—É–¥–∞–ª", pos: "n" },
    { kor: "ÏãúÏû•", mon: "–∑–∞—Ö", pos: "n" },
    { kor: "Í∞ÄÎã§", mon: "—è–≤–∞—Ö", pos: "v" },
    { kor: "ÏòÅÍµ≠", mon: "–ò—Ö –ë—Ä–∏—Ç–∞–Ω–∏", pos: "n" },
    { kor: "Ï±ÖÏÉÅ", mon: "—à–∏—Ä—ç—ç", pos: "n" },
    { kor: "ÌïôÍµê", mon: "—Å—É—Ä–≥—É—É–ª—å", pos: "n" },

    /* ‚úÖ Ïó¨Í∏∞! ÌòºÌï© Î¨∏Ïûê Ï†úÍ±∞: "ÎßàÏãú–¥–∞/Îßà—Å–∏–¥–∞" Í∞ôÏùÄ ÌòïÌÉú Í∏àÏßÄ */
    { kor: "ÎßàÏãúÎã§", mon: "—É—É—Ö", pos: "v" },

    { kor: "Î®πÎã§", mon: "–∏–¥—ç—Ö", pos: "v" },
    { kor: "Ï£ºÏä§", mon: "–∂“Ø“Ø—Å", pos: "n" },
    { kor: "Ìò∏Ï£º", mon: "–ê–≤—Å—Ç—Ä–∞–ª–∏", pos: "n" },
    { kor: "Ïßë", mon: "–≥—ç—Ä", pos: "n" },
    { kor: "ÏùòÏÇ¨", mon: "—ç–º—á", pos: "n" },
    { kor: "ÎØ∏Íµ≠", mon: "–ê–º–µ—Ä–∏–∫", pos: "n" },
    { kor: "ÌöåÏÇ¨Ïõê", mon: "–∫–æ–º–ø–∞–Ω–∏–π–Ω –∞–∂–∏–ª—Ç–∞–Ω", pos: "n" },
    { kor: "ÏÇ¨Îã§", mon: "—Ö—É–¥–∞–ª–¥–∞–∂ –∞–≤–∞—Ö", pos: "v" },
    { kor: "ÌîÑÎûëÏä§", mon: "–§—Ä–∞–Ω—Ü", pos: "n" },
    { kor: "Ïò§Îã§", mon: "–∏—Ä—ç—Ö", pos: "v" },
    { kor: "ÌîºÏûê", mon: "–ø–∏—Ü—Ü–∞", pos: "n" },
    { kor: "ÎèÑÏÑúÍ¥Ä", mon: "–Ω–æ–º—ã–Ω —Å–∞–Ω", pos: "n" },
    { kor: "Î™ΩÍ≥®", mon: "–ú–æ–Ω–≥–æ–ª", pos: "n" },
    { kor: "ÏùΩÎã§", mon: "—É–Ω—à–∏—Ö", pos: "v" },
    { kor: "ÌïúÍµ≠", mon: "–°–æ–ª–æ–Ω–≥–æ—Å", pos: "n" },
    { kor: "ÏÑ†ÏÉùÎãò", mon: "–±–∞–≥—à", pos: "n" },
    { kor: "Í∏∞Ïûê", mon: "—Å—ç—Ç–≥“Ø“Ø–ª—á", pos: "n" },
    { kor: "ÏãùÎãπ", mon: "—Ö–æ–æ–ª–Ω—ã –≥–∞–∑–∞—Ä", pos: "n" },
    { kor: "ÏöîÎ¶¨ÏÇ¨", mon: "—Ç–æ–≥–æ–æ—á", pos: "n" },
    { kor: "ÏöîÎ¶¨ÌïòÎã§", mon: "—Ö–æ–æ–ª —Ö–∏–π—Ö", pos: "v" },
    { kor: "Ï£ºÎã§", mon: "”©–≥”©—Ö", pos: "v" },
    { kor: "Ï§ëÍµ≠", mon: "–•—è—Ç–∞–¥", pos: "n" },
    { kor: "ÏÇ¨Îûå", mon: "—Ö“Ø–Ω", pos: "n" },
    { kor: "ÏùºÎ≥∏", mon: "–Ø–ø–æ–Ω", pos: "n" },
    { kor: "Íµ∞Ïù∏", mon: "—Ü—ç—Ä—ç–≥", pos: "n" },
    { kor: "Í∞ÄÏàò", mon: "–¥—É—É—á–∏–Ω", pos: "n" },
    { kor: "Ïñ¥Îäê", mon: "–∞–ª—å", pos: "o" },
    { kor: "ÏùòÏûê", mon: "—Å–∞–Ω–¥–∞–ª", pos: "n" },
    { kor: "Ïö¥ÎèôÌïòÎã§", mon: "–¥–∞—Å–≥–∞–ª —Ö–∏–π—Ö", pos: "v" },
    { kor: "ÎßàÌä∏", mon: "–¥—ç–ª–≥“Ø“Ø—Ä", pos: "n" },
    { kor: "ÌïôÏÉù", mon: "–æ—é—É—Ç–∞–Ω", pos: "n" },
    { kor: "Î∞±ÌôîÏ†ê", mon: "–∏—Ö –¥—ç–ª–≥“Ø“Ø—Ä", pos: "n" },
    { kor: "ÎèÖÏùº", mon: "–ì–µ—Ä–º–∞–Ω", pos: "n" }
  ];

  const PASS_SCORE = 80;
  const MAX_FAILS_BEFORE_PASS = 5;
  const STORE_KEY = "attempts_1A1_stable_v2";

  let attempts = localStorage.getItem(STORE_KEY) ? parseInt(localStorage.getItem(STORE_KEY), 10) : 0;
  let wordList = [], currentIdx = 0, score = 0, wrongWords = [], name = "";

  document.getElementById("vocabCount").innerText = `“Æ–≥–∏–π–Ω —Ç–æ–æ: ${rawWords.length}`;
  document.getElementById("userName").addEventListener("keydown", (e)=>{ if (e.key === "Enter") startQuiz(); });

  function shuffle(arr){
    const a = arr.slice();
    for (let i=a.length-1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  // ÌòºÌï© Î¨∏Ïûê Í≤ÄÏÇ¨(Î™®Îì† Í∏∞Ï¢Ö ÎèôÏùº)
  const reHangul = /[„Ñ±-„Öé„Öè-„Ö£Í∞Ä-Ìû£]/;
  const reCyril  = /[–ê-–Ø–∞-—è–Å—ë]/;

  function validateData(){
    const errors = [];
    rawWords.forEach((w, idx)=>{
      const where = `#${idx+1} (${w.kor} / ${w.mon})`;
      if (reCyril.test(w.kor)) errors.push(`${where} : "kor" —Ç–∞–ª–±–∞—Ä—Ç –∫–∏—Ä–∏–ª–ª “Ø—Å—ç–≥ –±–∞–π–Ω–∞.`);
      if (reHangul.test(w.mon)) errors.push(`${where} : "mon" —Ç–∞–ª–±–∞—Ä—Ç —Å–æ–ª–æ–Ω–≥–æ—Å “Ø—Å—ç–≥ –±–∞–π–Ω–∞.`);
      if (!w.kor || !w.mon || !w.pos) errors.push(`${where} : ”©–≥”©–≥–¥”©–ª –¥—É—Ç—É—É –±–∞–π–Ω–∞.`);
    });
    return errors;
  }

  function showOnly(sectionId){
    ["start-section","quiz-section","review-section","result-section","error-section"].forEach(id=>{
      document.getElementById(id).style.display = (id === sectionId) ? "block" : "none";
    });
  }
  function goHome(){ showOnly("start-section"); }

  function showDataHint(){
    const box = document.getElementById("dataHint");
    box.style.display = (box.style.display === "none") ? "block" : "none";
    box.innerHTML =
      `<b>–ó”©–≤ —Ñ–æ—Ä–º–∞—Ç</b><br>` +
      `kor: —Å–æ–ª–æ–Ω–≥–æ—Å “Ø–≥ (Hangul)<br>` +
      `mon: –º–æ–Ω–≥–æ–ª “Ø–≥ (Cyrillic)<br>` +
      `pos: n / v / o<br><br>` +
      `<b>–ñ–∏—à—ç—ç</b><br>` +
      `{"kor":"ÎßàÏãúÎã§","mon":"—É—É—Ö","pos":"v"}`;
  }

  function buildChoices(correct, dir, pos){
    const pickVal = (w) => (dir === "K2M" ? w.mon : w.kor);
    const samePos = rawWords.filter(w => w.pos === pos).map(pickVal).filter(x => x && x !== correct);
    const anyPos  = rawWords.map(pickVal).filter(x => x && x !== correct);

    let candidates = (pos === "o") ? shuffle(anyPos) : shuffle(samePos).concat(shuffle(anyPos));

    const distractors = [];
    for (const c of candidates){
      if (c !== correct && !distractors.includes(c)) distractors.push(c);
      if (distractors.length >= 3) break;
    }

    let choices = Array.from(new Set([correct, ...distractors]));
    if (choices.length < 4){
      for (const c of shuffle(anyPos)){
        if (!choices.includes(c)) choices.push(c);
        if (choices.length >= 4) break;
      }
    }
    while (choices.length < 4) choices.push(correct);

    return shuffle(choices.slice(0,4));
  }

  function prepareQuestions(){
    const shuffled = shuffle(rawWords);
    wordList = shuffled.map(w=>{
      const dir = Math.random() < 0.5 ? "K2M" : "M2K";
      const q = (dir === "K2M") ? w.kor : w.mon;
      const a = (dir === "K2M") ? w.mon : w.kor;
      return { dir, pos:w.pos, q, a, kor:w.kor, mon:w.mon, choices: buildChoices(a, dir, w.pos) };
    });
  }

  function startQuiz(){
    name = (document.getElementById("userName").value || "").trim();
    if (!name){ alert("–ù—ç—Ä—ç—ç –æ—Ä—É—É–ª–Ω–∞ —É—É!"); return; }

    const errs = validateData();
    if (errs.length){
      document.getElementById("errorDetail").innerHTML =
        "<b>–û–ª–¥—Å–æ–Ω –∞—Å—É—É–¥–∞–ª:</b><br>" + errs.map(e => "‚Ä¢ " + e).join("<br>");
      showOnly("error-section");
      return;
    }

    currentIdx = 0; score = 0; wrongWords = [];
    prepareQuestions();
    document.getElementById("attemptMetaQuiz").innerText = `–û—Ä–æ–ª–¥–ª–æ–≥–æ: ${attempts} / ${MAX_FAILS_BEFORE_PASS}`;
    showOnly("quiz-section");
    showQuestion();
  }

  function showQuestion(){
    if (currentIdx >= wordList.length) return finishQuiz();

    const item = wordList[currentIdx];
    document.getElementById("question-number").innerText = `${currentIdx+1} / ${wordList.length}`;

    const qLang = (item.dir === "K2M") ? "–°–æ–ª–æ–Ω–≥–æ—Å" : "–ú–æ–Ω–≥–æ–ª";
    const cLang = (item.dir === "K2M") ? "–ú–æ–Ω–≥–æ–ª" : "–°–æ–ª–æ–Ω–≥–æ—Å";

    document.getElementById("question-instruction").innerHTML =
      `–ê—Å—É—É–ª—Ç: <span class="tag">${qLang}</span> ¬∑ –°–æ–Ω–≥–æ–ª—Ç: <span class="tag">${cLang}</span><br>` +
      (item.dir === "K2M" ? "–ó”©–≤ –ú–æ–Ω–≥–æ–ª –æ—Ä—á—É—É–ª–≥—ã–≥ —Å–æ–Ω–≥–æ–Ω–æ —É—É." : "–ó”©–≤ –°–æ–ª–æ–Ω–≥–æ—Å “Ø–≥–∏–π–≥ —Å–æ–Ω–≥–æ–Ω–æ —É—É.");

    document.getElementById("question-text").innerText = item.q;

    const choicesDiv = document.getElementById("choices");
    choicesDiv.innerHTML = "";

    let locked = false;
    item.choices.forEach(choice=>{
      const btn = document.createElement("button");
      btn.className = "choice-btn";
      btn.innerText = choice;
      btn.onclick = ()=>{
        if (locked) return;
        locked = true;
        checkAnswer(choice);
      };
      choicesDiv.appendChild(btn);
    });
  }

  function checkAnswer(ans){
    const item = wordList[currentIdx];
    if (ans === item.a) score += (100 / wordList.length);
    else wrongWords.push(item);
    currentIdx++;
    showQuestion();
  }

  function finishQuiz(){
    attempts++;
    localStorage.setItem(STORE_KEY, String(attempts));
    const finalScore = Math.round(score);

    if (finalScore >= PASS_SCORE || attempts >= MAX_FAILS_BEFORE_PASS){
      const forced = (attempts >= MAX_FAILS_BEFORE_PASS && finalScore < PASS_SCORE);
      document.getElementById("result-title").innerText = forced ? "üí™ –¢—ç–Ω—Ü–ª—ç—ç!" : "üéâ –¢—ç–Ω—Ü–ª—ç—ç!";

      document.getElementById("resultLineName").innerHTML = `–ù—ç—Ä: <b>${escapeHtml(name)}</b>`;
      document.getElementById("resultLineScore").innerHTML = `–î“Ø–Ω: <span class="score-text">${finalScore} –æ–Ω–æ–æ</span>`;
      document.getElementById("resultLineAttempts").innerHTML = `–û—Ä–æ–ª–¥–ª–æ–≥–æ: <b>${attempts}</b>`;
      document.getElementById("captureStatus").innerText = "";

      localStorage.removeItem(STORE_KEY);
      attempts = 0;

      showOnly("result-section");
    } else {
      showReview(finalScore);
    }
  }

  function showReview(finalScore){
    document.getElementById("attemptMetaReview").innerText = `–û—Ä–æ–ª–¥–ª–æ–≥–æ: ${attempts} / ${MAX_FAILS_BEFORE_PASS}`;
    const container = document.getElementById("wrong-answers-container");
    container.innerHTML = `<div style="font-weight:1000; color:#d33;">–¢–∞–Ω—ã –¥“Ø–Ω: ${finalScore} –æ–Ω–æ–æ</div>`;

    wrongWords.forEach(w=>{
      const qLang = (w.dir === "K2M") ? "–°–æ–ª–æ–Ω–≥–æ—Å" : "–ú–æ–Ω–≥–æ–ª";
      const aLang = (w.dir === "K2M") ? "–ú–æ–Ω–≥–æ–ª" : "–°–æ–ª–æ–Ω–≥–æ—Å";
      const div = document.createElement("div");
      div.className = "wrong-item";
      div.innerHTML =
        `‚ùì <span class="tag">${qLang}</span> <b>${escapeHtml(w.q)}</b><br>` +
        `‚úÖ <span class="tag">${aLang}</span> <b>${escapeHtml(w.a)}</b><br>` +
        `<span style="color:#6a7a8e; font-size:13px;">KO: ${escapeHtml(w.kor)} ¬∑ MN: ${escapeHtml(w.mon)}</span>`;
      container.appendChild(div);
    });

    showOnly("review-section");
  }

  function retryQuiz(){ currentIdx = 0; score = 0; wrongWords = []; prepareQuestions(); showOnly("quiz-section"); showQuestion(); }
  function restartAttempt(){ currentIdx = 0; score = 0; wrongWords = []; prepareQuestions(); showOnly("quiz-section"); showQuestion(); }

  function resetAll(){
    localStorage.removeItem(STORE_KEY);
    attempts = 0; currentIdx = 0; score = 0; wrongWords = []; name = "";
    document.getElementById("userName").value = "";
    showOnly("start-section");
  }

  // Í≤∞Í≥º Ïπ¥Îìú -> Ïù¥ÎØ∏ÏßÄ(Í≥µÏú† ÏßÄÏõê Ïãú share, ÏïÑÎãàÎ©¥ Îã§Ïö¥Î°úÎìú)
  function captureResultCard(){
    const status = document.getElementById("captureStatus");
    status.innerText = "–ó—É—Ä–∞–≥ “Ø“Ø—Å–≥—ç–∂ –±–∞–π–Ω–∞...";

    const target = document.getElementById("captureTarget");
    const rect = target.getBoundingClientRect();
    const scale = Math.max(2, Math.floor((window.devicePixelRatio || 1)));

    const canvas = document.createElement("canvas");
    canvas.width  = Math.floor(rect.width * scale);
    canvas.height = Math.floor(rect.height * scale);

    const ctx = canvas.getContext("2d");
    ctx.scale(scale, scale);

    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, rect.width, rect.height);
    ctx.strokeStyle = "#d9e4f5";
    ctx.lineWidth = 1;
    ctx.strokeRect(0.5, 0.5, rect.width-1, rect.height-1);

    const lines = [
      "“Æ—Ä –¥“Ø–Ω",
      stripHtml(document.getElementById("resultLineName").innerHTML),
      stripHtml(document.getElementById("resultLineScore").innerHTML).replace(/\s+/g," ").trim(),
      stripHtml(document.getElementById("resultLineAttempts").innerHTML),
      "–≠–Ω—ç –¥—ç–ª–≥—ç—Ü–∏–π–≥ —Å–∫—Ä–∏–Ω—à–æ—Ç —Ö–∏–π–∂ –±–∞–≥—à —Ä—É—É–≥–∞–∞ –∏–ª–≥—ç—ç–Ω—ç “Ø“Ø!"
    ];

    ctx.fillStyle = "#1f2f45";
    ctx.font = "900 16px Arial";
    let x=14, y=26;
    ctx.fillText(lines[0], x, y);

    ctx.fillStyle = "#223047";
    ctx.font = "900 16px Arial";
    y+=26; ctx.fillText(lines[1], x, y);
    y+=26; ctx.fillText(lines[2], x, y);
    y+=26; ctx.fillText(lines[3], x, y);

    y+=26;
    ctx.fillStyle = "#6a7a8e";
    ctx.font = "900 13px Arial";
    wrapText(ctx, lines[4], x, y, rect.width-28, 18);

    canvas.toBlob(async (blob)=>{
      if (!blob){ status.innerText="–ê–ª–¥–∞–∞: –∑—É—Ä–∞–≥ “Ø“Ø—Å–≥—ç–∂ —á–∞–¥—Å–∞–Ω–≥“Ø–π."; return; }
      const fileName = `result_1A1_${Date.now()}.png`;
      const file = new File([blob], fileName, { type:"image/png" });

      try{
        if (navigator.canShare && navigator.canShare({ files:[file] })){
          await navigator.share({ files:[file], title:"“Æ—Ä –¥“Ø–Ω", text:"“Æ—Ä –¥“Ø–Ω–≥—ç—ç –±–∞–≥—à–¥–∞–∞ —è–≤—É—É–ª–Ω–∞ —É—É." });
          status.innerText="–ê–º–∂–∏–ª—Ç—Ç–∞–π! –û–¥–æ–æ –±–∞–≥—à–¥–∞–∞ —è–≤—É—É–ª–Ω–∞ —É—É.";
        } else {
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url; a.download = fileName;
          document.body.appendChild(a); a.click(); a.remove();
          URL.revokeObjectURL(url);
          status.innerText="–ó—É—Ä–∞–≥ —Ç–∞—Ç–∞–≥–¥–ª–∞–∞. –ë–∞–≥—à–¥–∞–∞ –∏–ª–≥—ç—ç–Ω—ç “Ø“Ø.";
        }
      } catch(e){
        status.innerText="–ó—É—Ä–∞–≥ —Ö–∞–¥–≥–∞–ª–∞–≥–¥–ª–∞–∞. –ë–∞–≥—à–¥–∞–∞ –∏–ª–≥—ç—ç–Ω—ç “Ø“Ø.";
      }
    }, "image/png");
  }

  function stripHtml(html){ const tmp=document.createElement("div"); tmp.innerHTML=html; return (tmp.textContent||tmp.innerText||"").trim(); }
  function wrapText(ctx,text,x,y,maxWidth,lineHeight){
    const words=text.split(" "); let line="";
    for (let n=0;n<words.length;n++){
      const test=line+words[n]+" ";
      if (ctx.measureText(test).width>maxWidth && n>0){
        ctx.fillText(line.trim(),x,y); line=words[n]+" "; y+=lineHeight;
      } else line=test;
    }
    if (line.trim()) ctx.fillText(line.trim(),x,y);
  }
  function escapeHtml(s){
    return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#39;");
  }
</script>
</body>
</html>
