<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ì„œìš¸ëŒ€ ë ˆìŠ¨</title>
  <style>
    :root{
      --bg:#0b1220;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--line:#243044;
      --accent:#60a5fa;--ok:#34d399;--bad:#f87171;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Arial,sans-serif;
      background:linear-gradient(180deg,#050814,var(--bg));
      color:var(--text);
    }
    a{color:inherit;text-decoration:none}
    .topbar{
      position:sticky;top:0;z-index:10;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:12px 16px;background:rgba(5,8,20,.75);backdrop-filter:blur(10px);
      border-bottom:1px solid var(--line);
    }
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .dot{width:10px;height:10px;border-radius:999px;background:var(--accent)}
    .container{max-width:980px;margin:0 auto;padding:16px}
    .card{
      background:rgba(17,24,39,.9);
      border:1px solid var(--line);
      border-radius:16px;
      padding:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .muted{color:var(--muted);line-height:1.6}
    .btn{
      padding:10px 12px;border-radius:12px;border:1px solid var(--line);
      background:#0b1020;color:var(--text);cursor:pointer;display:inline-block
    }
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btnRow{display:flex;gap:8px;flex-wrap:wrap}
    .tag{
      display:inline-block;padding:2px 8px;border:1px solid var(--line);
      border-radius:999px;background:#0b1020;color:var(--muted);font-size:12px
    }
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .tab{
      padding:10px 12px;border-radius:12px;border:1px solid var(--line);
      background:#0b1020;color:var(--text);cursor:pointer
    }
    .tab.active{border-color:rgba(96,165,250,.7);color:var(--text)}
    .panel{display:none;margin-top:12px}
    .panel.active{display:block}
    .bar{height:1px;background:var(--line);margin:12px 0}

    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border-bottom:1px solid var(--line);padding:10px;vertical-align:top}
    th{color:var(--muted);text-align:left}

    .qbox{border:1px solid var(--line);background:#0b1020;border-radius:16px;padding:14px}
    .choices{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
    @media(max-width:800px){.choices{grid-template-columns:1fr}}
    .choice{padding:12px;border-radius:14px;border:1px solid var(--line);background:#0b1020;color:var(--text);cursor:pointer;text-align:left}
    .choice:hover{border-color:rgba(96,165,250,.6)}
    .result{margin-top:10px;padding:12px;border-radius:14px;border:1px solid var(--line);background:rgba(11,16,32,.7)}
    .result.ok{border-color:rgba(52,211,153,.6)}
    .result.bad{border-color:rgba(248,113,113,.6)}
    .small{font-size:13px}
  </style>
  <!-- âœ… Mobile Quiz Readability Patch (Question/Choices bigger + centered) -->
<style>
  /* í€´ì¦ˆ(ë¬¸ì œ/ì„ íƒì§€) ì˜ì—­ì„ ê°€ìš´ë°ë¡œ */
  #quizArea, #testArea, .quiz-area, .test-area, .vocab-test, .quizCard, .quiz-card {
    margin-left: auto !important;
    margin-right: auto !important;
    text-align: center !important;
  }

  /* ë¬¸ì œ(ë‹¨ì–´) í…ìŠ¤íŠ¸: í¬ê²Œ + ì¤‘ì•™ì •ë ¬ */
  #questionText, #testQuestion, .questionText, .test-question, .qText, .question, .question-word {
    font-weight: 800 !important;
    line-height: 1.15 !important;
    word-break: keep-all !important;
    overflow-wrap: anywhere !important;
    text-align: center !important;
    margin: 10px auto 14px auto !important;
  }

  /* ì„ íƒì§€ ë²„íŠ¼: í¬ê²Œ + í„°ì¹˜í•˜ê¸° ì‰½ê²Œ + ì¤‘ì•™ */
  #choices button, #choiceList button, .choices button, .choice button,
  .choiceBtn, .choice-btn, .optionBtn, .option-btn {
    width: 100% !important;
    max-width: 520px !important;
    margin: 10px auto !important;
    padding: 16px 14px !important;
    border-radius: 16px !important;
    text-align: center !important;
    line-height: 1.2 !important;
  }

  /* ë²„íŠ¼ ì•ˆì˜ ê¸€ìë„ ì¤‘ì•™ */
  #choices button *, #choiceList button *, .choices button *, .choiceBtn *, .optionBtn * {
    text-align: center !important;
  }

  /* ğŸ“± íœ´ëŒ€í°ì—ì„œ ê¸€ì í¬ê²Œ + ìœ„ìª½ ì¡ë‹¤í•œ ì˜ì—­ì€ ì‘ê²Œ */
  @media (max-width: 520px) {
    /* ì•ˆë‚´/ì„¤ëª… ê¸€ì´ í¬ë©´ í€´ì¦ˆê°€ ì‘ì•„ ë³´ì´ë¯€ë¡œ ì¶•ì†Œ */
    .hint, .help, .desc, .description, .note, .subText, .smallNote {
      font-size: 12px !important;
      line-height: 1.25 !important;
      margin: 6px auto !important;
      max-width: 95vw !important;
    }

    /* í€´ì¦ˆ ì¹´ë“œ(ì˜ì—­) í­ì„ íœ´ëŒ€í°ì— ë§ì¶¤ */
    #quizArea, #testArea, .quiz-area, .test-area, .vocab-test, .quizCard, .quiz-card {
      width: min(94vw, 640px) !important;
      margin-top: 10px !important;
      padding-top: 10px !important;
    }

    /* âœ… í•µì‹¬: ë¬¸ì œ/ì„ íƒì§€ ê¸€ì í¬ê¸° */
    #questionText, #testQuestion, .questionText, .test-question, .qText, .question, .question-word {
      font-size: 34px !important; /* ë¬¸ì œ(ë‹¨ì–´) */
    }

    #choices button, #choiceList button, .choices button, .choice button,
    .choiceBtn, .choice-btn, .optionBtn, .option-btn {
      font-size: 22px !important; /* ì„ íƒì§€ */
    }

    /* ë²„íŠ¼ ì•ˆì— ì‘ì€ ê¸€ì”¨ê°€ ìˆìœ¼ë©´ ì¡°ê¸ˆë§Œ ì‘ê²Œ */
    #choices button small, .choices button small, .choiceBtn small, .optionBtn small {
      font-size: 14px !important;
      opacity: .85 !important;
    }
  }
</style>
  <!-- âœ… Mobile Quiz Layout Patch v2 (Question centered + +1pt vs choices + tighter spacing + no-scroll fit) -->
<style>
  /* ê°€ë¡œ ìŠ¤í¬ë¡¤(ì˜†ìœ¼ë¡œ ë°€ë¦¼) ë°©ì§€ */
  html, body { overflow-x: hidden !important; }

  /* âœ… â€œì§ˆë¬¸ì´ ì™¼ìª½ìœ¼ë¡œ ì ë¦¬ëŠ” ë¬¸ì œâ€ë¥¼ ê°•ì œë¡œ ì¤‘ì•™ ì •ë ¬ */
  /* ì§ˆë¬¸ í…ìŠ¤íŠ¸ í›„ë³´ë¥¼ ìµœëŒ€í•œ ë„“ê²Œ ì»¤ë²„ */
  #questionText, #testQuestion, .questionText, .test-question, .qText, .question, .question-word,
  .questionWord, .question-word, .wordQuestion, .word-question,
  .card .question, .card .q, .quizCard .question, .quiz-card .question,
  .quizCard h2, .quizCard h3, .quiz-card h2, .quiz-card h3 {
    display: block !important;
    width: 100% !important;
    text-align: center !important;
    margin-left: auto !important;
    margin-right: auto !important;
  }

  /* ëª¨ë°”ì¼ì—ì„œ â€œí€´ì¦ˆê°€ í™”ë©´ ì•ˆì— ë‹¤ ë³´ì´ê²Œâ€ ë” ê½‰ ì°¨ê²Œ */
  @media (max-width: 520px) {

    /* ìƒë‹¨/ë¶€ê°€ ì˜ì—­ì´ ë„ˆë¬´ í¬ë©´ ì¤„ì—¬ì„œ í€´ì¦ˆì— ê³µê°„ì„ ì¤Œ */
    header, .topbar, .toolbar, .header, .controls, .controlRow, .tabs, .tabRow {
      margin-bottom: 6px !important;
      padding-bottom: 0 !important;
    }

    /* ì„¤ëª…/ì•ˆë‚´ ë¬¸êµ¬ê°€ ê¸¸ë©´ ë„ˆë¬´ ê³µê°„ì„ ì°¨ì§€í•˜ë¯€ë¡œ ë” ì‘ê²Œ */
    .hint, .help, .desc, .description, .note, .subText, .smallNote {
      font-size: 11px !important;
      line-height: 1.2 !important;
      margin: 4px auto !important;
    }

    /* âœ… í€´ì¦ˆ ì¹´ë“œ ìì²´ë¥¼ í™”ë©´ í­ì— ë§ì¶°ì„œ ê½‰ ì±„ì›€ */
    #quizArea, #testArea, .quiz-area, .test-area, .vocab-test, .quizCard, .quiz-card,
    .card, .panel, .container .card {
      width: min(96vw, 680px) !important;
      margin-left: auto !important;
      margin-right: auto !important;
      padding-top: 8px !important;
      padding-bottom: 8px !important;
    }

    /* âœ… í•µì‹¬: ê¸€ì í¬ê¸° (ì§ˆë¬¸ì´ ì„ íƒì§€ë³´ë‹¤ 1pt ë” í¬ê²Œ) */
    /* ì„ íƒì§€ */
    #choices button, #choiceList button, .choices button, .choice button,
    .choiceBtn, .choice-btn, .optionBtn, .option-btn {
      font-size: 22px !important;
      padding: 12px 12px !important;   /* ê¸°ì¡´ë³´ë‹¤ íŒ¨ë”© ì¤„ì—¬ì„œ í™”ë©´ì— ë” ë§ì´ ë³´ì´ê²Œ */
      margin: 6px auto !important;     /* âœ… ê°„ê²© ì¤„ì´ê¸° */
      max-width: 520px !important;
      width: 100% !important;
      line-height: 1.15 !important;
    }

    /* ì§ˆë¬¸(ë‹¨ì–´) = ì„ íƒì§€ë³´ë‹¤ 1pt í¬ê²Œ */
    #questionText, #testQuestion, .questionText, .test-question, .qText, .question, .question-word,
    .questionWord, .wordQuestion, .word-question,
    .quizCard h2, .quizCard h3, .quiz-card h2, .quiz-card h3 {
      font-size: 23px !important;      /* âœ… 22 + 1 */
      font-weight: 900 !important;
      line-height: 1.15 !important;
      margin: 6px auto 10px auto !important;
      text-align: center !important;
    }

    /* âœ… ì„ íƒì§€ ë¦¬ìŠ¤íŠ¸ê°€ flex/gridë¼ë©´ ê°„ê²© ê°•ì œ ì¶•ì†Œ */
    #choices, #choiceList, .choices, .options, .optionList {
      gap: 6px !important;
    }

    /* âœ… í™”ë©´ ì•„ë˜ë¡œ â€œìŠ¤í¬ë¡¤í•´ì•¼ ì„ íƒì§€ê°€ ë‹¤ ë³´ì´ëŠ” ë¬¸ì œâ€ ì™„í™”:
       ì¹´ë“œ ë°”ê¹¥ ì—¬ë°±ì„ ì¤„ì´ê³ , ë²„íŠ¼ ë†’ì´ë¥¼ ì¤„ì—¬ í•œ í™”ë©´ì— ë“¤ì–´ì˜¤ê²Œ í•¨ */
    .wrap, .page, .main, .content, .container {
      padding-bottom: 8px !important;
    }

    /* ë²„íŠ¼ ì•ˆì˜ ê¸´ í…ìŠ¤íŠ¸ëŠ” ì¤„ë°”ê¿ˆ í—ˆìš©(ì˜† ìŠ¤í¬ë¡¤ ë°©ì§€) */
    #choices button, #choiceList button, .choices button,
    .choiceBtn, .optionBtn {
      white-space: normal !important;
      overflow-wrap: anywhere !important;
      word-break: keep-all !important;
    }
  }
</style>
</head>
<body>
  <header class="topbar">
    <div class="brand"><span class="dot"></span><a href="../index.html">Korean Quiz</a></div>
    <div class="btnRow">
      <button class="btn" id="btnLang">KR</button>
      <a class="btn" href="./index.html" id="btnSnuList">ì„œìš¸ëŒ€ ëª©ë¡</a>
      <a class="btn" href="../index.html" id="btnDashboard">ëŒ€ì‹œë³´ë“œ</a>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div style="display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;align-items:flex-end">
        <div>
          <h1 style="margin:0 0 6px;" id="title">ë ˆìŠ¨</h1>
          <div class="muted" id="subtitle">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
        <div class="muted small" id="status"></div>
      </div>

      <div class="tabs" role="tablist" aria-label="lesson tabs">
        <button class="tab active" id="tab-vocab" type="button">ì–´íœ˜ ë³´ê¸°</button>
        <button class="tab" id="tab-quiz" type="button">ì–´íœ˜ í…ŒìŠ¤íŠ¸</button>
        <button class="tab" id="tab-grammar" type="button">ë¬¸ë²•</button>
      </div>

      <div class="bar"></div>

      <div class="panel active" id="panel-vocab">
        <div class="btnRow" id="legacyRowVocab" style="margin-bottom:10px;display:none;">
          <a class="btn" id="legacyBtnVocab" href="#">ê¸°ì¡´ ì–´íœ˜(HTML) ë³´ê¸°</a>
        </div>
        <div id="vocab"></div>
      </div>

      <div class="panel" id="panel-quiz">
        <div class="btnRow" style="margin-bottom:10px;">
          <button class="btn" id="btnMode" type="button">ë°©í–¥: í•œêµ­ì–´ â†’ ëª½ê³¨ì–´</button>
          <button class="btn" id="btnNew" type="button">ìƒˆ ë¬¸ì œ</button>
          <a class="btn" id="legacyBtnQuiz" href="#" style="display:none;">ê¸°ì¡´ ìë£Œ(HTML) ë³´ê¸°</a>
        </div>
        <div class="muted small" id="quizHint"></div>
        <div class="bar"></div>
        <div id="quiz"></div>
      </div>

      <div class="panel" id="panel-grammar">
        <div id="grammar"></div>
      </div>
    </section>
  </main>

  <script>
    // ---- i18n ----
    const I18N = {
      KR: {
        dashboard: "ëŒ€ì‹œë³´ë“œ",
        snuList: "ì„œìš¸ëŒ€ ëª©ë¡",
        loading: "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...",
        loaded: "ë¡œë“œ ì™„ë£Œ",
        vocabView: "ì–´íœ˜ ë³´ê¸°",
        vocabQuiz: "ì–´íœ˜ í…ŒìŠ¤íŠ¸",
        grammar: "ë¬¸ë²•",
        legacyVocab: "ê¸°ì¡´ ì–´íœ˜(HTML) ë³´ê¸°",
        legacyHtml: "ê¸°ì¡´ ìë£Œ(HTML) ë³´ê¸°",
        thKo: "í•œêµ­ì–´",
        thMn: "ëª½ê³¨ì–´",
        thEx: "ì˜ˆë¬¸",
        noVocab: "ì–´íœ˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.",
        useLegacy: "ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ê¸°ì¡´ ìë£Œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
        noGrammar: "ë¬¸ë²•ì´ ì—†ìŠµë‹ˆë‹¤.",
        modeK2M: "ë°©í–¥: í•œêµ­ì–´ â†’ ëª½ê³¨ì–´",
        modeM2K: "ë°©í–¥: ëª½ê³¨ì–´ â†’ í•œêµ­ì–´",
        newQ: "ìƒˆ ë¬¸ì œ",
        quizHint: (n)=> n ? `ì–´íœ˜ ${n}ê°œë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤. (4ì§€ì„ ë‹¤, ëœë¤)` : "ì–´íœ˜ ë°ì´í„°ê°€ ì—†ì–´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
        qLabel: "ë¬¸ì œ",
        correct: "ì •ë‹µ!",
        wrong: "ì˜¤ë‹µ!",
        answer: "ì •ë‹µ"
      },
      MN: {
        dashboard: "Ğ¡Ğ°Ğ¼Ğ±Ğ°Ñ€",
        snuList: "Ğ¡Ó¨Ò® (Ğ¶Ğ°Ğ³ÑĞ°Ğ°Ğ»Ñ‚)",
        loading: "ĞÑ‡Ğ°Ğ°Ğ»Ğ¶ Ğ±Ğ°Ğ¹Ğ½Ğ°...",
        loaded: "ĞÑ‡Ğ°Ğ°Ğ»Ğ»Ğ°Ğ°",
        vocabView: "Ò®Ğ³ Ñ…Ğ°Ñ€Ğ°Ñ…",
        vocabQuiz: "Ò®Ğ³ ÑˆĞ°Ğ»Ğ³Ğ°Ğ»Ñ‚",
        grammar: "Ğ”Ò¯Ñ€ÑĞ¼",
        legacyVocab: "Ğ¥ÑƒÑƒÑ‡Ğ¸Ğ½ Ò¯Ğ³Ñ (HTML) Ñ…Ğ°Ñ€Ğ°Ñ…",
        legacyHtml: "Ğ¥ÑƒÑƒÑ‡Ğ¸Ğ½ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ» (HTML) Ñ…Ğ°Ñ€Ğ°Ñ…",
        thKo: "Ğ¡Ğ¾Ğ»Ğ¾Ğ½Ğ³Ğ¾Ñ",
        thMn: "ĞœĞ¾Ğ½Ğ³Ğ¾Ğ»",
        thEx: "Ğ–Ğ¸ÑˆÑÑ",
        noVocab: "Ò®Ğ³Ğ¸Ğ¹Ğ½ Ó©Ğ³Ó©Ğ³Ğ´Ó©Ğ» Ğ°Ğ»Ğ³Ğ°.",
        useLegacy: "Ğ”Ğ¾Ğ¾Ñ€Ñ… Ñ‚Ğ¾Ğ²Ñ‡Ğ¾Ğ¾Ñ€ Ñ…ÑƒÑƒÑ‡Ğ¸Ğ½ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹Ğ³ Ğ°ÑˆĞ¸Ğ³Ğ»Ğ°Ğ¶ Ğ±Ğ¾Ğ»Ğ½Ğ¾.",
        noGrammar: "Ğ”Ò¯Ñ€ÑĞ¼ Ğ±Ğ°Ğ¹Ñ…Ğ³Ò¯Ğ¹.",
        modeK2M: "Ğ§Ğ¸Ğ³Ğ»ÑĞ»: Ğ¡Ğ¾Ğ»Ğ¾Ğ½Ğ³Ğ¾Ñ â†’ ĞœĞ¾Ğ½Ğ³Ğ¾Ğ»",
        modeM2K: "Ğ§Ğ¸Ğ³Ğ»ÑĞ»: ĞœĞ¾Ğ½Ğ³Ğ¾Ğ» â†’ Ğ¡Ğ¾Ğ»Ğ¾Ğ½Ğ³Ğ¾Ñ",
        newQ: "Ğ¨Ğ¸Ğ½Ñ Ğ°ÑÑƒÑƒĞ»Ñ‚",
        quizHint: (n)=> n ? `Ò®Ğ³ ${n} ÑˆĞ¸Ñ€Ñ…ÑĞ³ÑÑÑ€ ÑˆĞ°Ğ»Ğ³Ğ°Ğ½Ğ°. (4 ÑĞ¾Ğ½Ğ³Ğ¾Ğ»Ñ‚, ÑĞ°Ğ½Ğ°Ğ¼ÑĞ°Ñ€Ğ³Ò¯Ğ¹)` : "Ò®Ğ³ Ğ±Ğ°Ğ¹Ñ…Ğ³Ò¯Ğ¹ Ñ‚ÑƒĞ» ÑˆĞ°Ğ»Ğ³Ğ°Ğ»Ñ‚ Ò¯Ò¯ÑĞ³ÑĞ¶ Ñ‡Ğ°Ğ´ÑĞ°Ğ½Ğ³Ò¯Ğ¹.",
        qLabel: "ĞÑÑƒÑƒĞ»Ñ‚",
        correct: "Ğ—Ó©Ğ²!",
        wrong: "Ğ‘ÑƒÑ€ÑƒÑƒ!",
        answer: "Ğ—Ó©Ğ² Ñ…Ğ°Ñ€Ğ¸ÑƒĞ»Ñ‚"
      }
    };

    function getLang(){
      const u = new URL(location.href);
      const q = (u.searchParams.get("lang")||"").toUpperCase();
      const s1 = (localStorage.getItem("lang")||"").toUpperCase();
      const s2 = (localStorage.getItem("kq_lang")||"").toUpperCase();
      const s3 = (localStorage.getItem("language")||"").toUpperCase();
      const pick = (q==="MN"||q==="KR") ? q : (s2||s1||s3);
      return (pick==="MN") ? "MN" : "KR";
    }
    function setLang(l){
      localStorage.setItem("lang", l);
      localStorage.setItem("kq_lang", l);
      localStorage.setItem("language", l);
    }
    function tr(key, arg){
      const L = getLang();
      const v = (I18N[L] && I18N[L][key]) ? I18N[L][key] : I18N.KR[key];
      return (typeof v === "function") ? v(arg) : v;
    }

    function getParam(name){
      const u = new URL(location.href);
      return u.searchParams.get(name);
    }
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }

    function setActiveTab(which){
      const tabs = [
        {t:document.getElementById("tab-vocab"), p:document.getElementById("panel-vocab"), k:"vocab"},
        {t:document.getElementById("tab-quiz"), p:document.getElementById("panel-quiz"), k:"quiz"},
        {t:document.getElementById("tab-grammar"), p:document.getElementById("panel-grammar"), k:"grammar"}
      ];
      tabs.forEach(x=>{
        const on = x.k===which;
        x.t.classList.toggle("active", on);
        x.p.classList.toggle("active", on);
      });
    }

    let LESSON = null;
    let QUIZ_MODE = "KO2MN"; // or MN2KO

    function applyTexts(){
      document.documentElement.lang = (getLang()==="MN") ? "mn" : "ko";
      document.getElementById("btnLang").textContent = getLang();
      document.getElementById("btnDashboard").textContent = tr("dashboard");
      document.getElementById("btnSnuList").textContent = tr("snuList");
      document.getElementById("subtitle").textContent = tr("loading");

      document.getElementById("tab-vocab").textContent = tr("vocabView");
      document.getElementById("tab-quiz").textContent = tr("vocabQuiz");
      document.getElementById("tab-grammar").textContent = tr("grammar");

      document.getElementById("legacyBtnVocab").textContent = tr("legacyVocab");
      document.getElementById("legacyBtnQuiz").textContent = tr("legacyHtml");

      document.getElementById("btnNew").textContent = tr("newQ");
      document.getElementById("btnMode").textContent = (QUIZ_MODE==="KO2MN") ? tr("modeK2M") : tr("modeM2K");
    }

    function renderVocab(d){
      const vocabDiv = document.getElementById("vocab");
      const legacyRow = document.getElementById("legacyRowVocab");
      const legacyBtn = document.getElementById("legacyBtnVocab");

      if(d.legacy_vocab_url){
        legacyBtn.href = d.legacy_vocab_url;
        legacyRow.style.display = "";
      } else {
        legacyRow.style.display = "none";
      }

      const vocab = d.vocab || [];
      if(vocab.length){
        let html = `<table><thead><tr>
          <th>${tr("thKo")}</th><th>${tr("thMn")}</th><th>${tr("thEx")}</th>
        </tr></thead><tbody>`;
        vocab.forEach(v=>{
          const ko = v.ko || "";
          const mn = v.mn || "";
          const pos = v.pos ? ` <span class="tag">${v.pos}</span>` : "";
          const exKr = v.example_kr || "";
          const exMn = v.example_mn || "";
          const ex = (exKr || exMn)
            ? `${exKr ? exKr : ""}${exMn ? "<br/><span class='muted'>" + exMn + "</span>" : ""}`
            : "<span class='muted'>-</span>";
          html += `<tr>
            <td><b>${ko}</b>${pos}</td>
            <td>${mn || "<span class='muted'>-</span>"}</td>
            <td>${ex}</td>
          </tr>`;
        });
        html += "</tbody></table>";
        vocabDiv.innerHTML = html;
      } else {
        vocabDiv.innerHTML =
          `<div class='muted'>${tr("noVocab")}</div>` +
          (d.legacy_vocab_url ? `<div class='muted small' style='margin-top:6px;'>${tr("useLegacy")}</div>` : "");
      }
    }

    function renderGrammar(d){
      const gramDiv = document.getElementById("grammar");
      const grammar = d.grammar || [];
      if(grammar.length){
        let html = "";
        grammar.forEach(g=>{
          const examples = (g.examples || []).map(e=>{
            const kr = e.kr || "";
            const mn = e.mn || "";
            return `<div style="margin-top:8px;">â€¢ ${kr}<br/><span class="muted">${mn}</span></div>`;
          }).join("");
          html += `<div class="card" style="margin-top:10px;">
            <div style="font-weight:900;">${g.title || ""} <span class="tag">${g.pattern || ""}</span></div>
            <div class="muted" style="margin-top:6px;">${g.use_kr || ""}</div>
            ${g.use_mn ? `<div class="muted" style="margin-top:6px;">${g.use_mn}</div>` : ""}
            ${examples ? `<div style="margin-top:10px;">${examples}</div>` : ""}
          </div>`;
        });
        gramDiv.innerHTML = html;
      } else {
        gramDiv.innerHTML = `<div class='muted'>${tr("noGrammar")}</div>`;
      }
    }

    function pickQuestion(vocab){
      const pool = vocab.filter(v => (v.ko || v.mn));
      if(!pool.length) return null;

      const q = pool[Math.floor(Math.random()*pool.length)];
      const getPrompt = (v) => QUIZ_MODE==="KO2MN" ? (v.ko||"") : (v.mn||"");
      const getAnswer = (v) => QUIZ_MODE==="KO2MN" ? (v.mn||"") : (v.ko||"");

      const correct = getAnswer(q);
      const prompt = getPrompt(q);
      if(!prompt || !correct) return null;

      const others = pool.map(v => getAnswer(v)).filter(a => a && a !== correct);
      const uniq = Array.from(new Set(others));
      const distractors = shuffle(uniq).slice(0, 3);
      const choices = shuffle([correct, ...distractors]);

      return { prompt, correct, choices };
    }

    function renderQuiz(d){
      const quizDiv = document.getElementById("quiz");
      const hint = document.getElementById("quizHint");
      const legacyBtnQuiz = document.getElementById("legacyBtnQuiz");

      if(d.legacy_vocab_url){
        legacyBtnQuiz.href = d.legacy_vocab_url;
        legacyBtnQuiz.style.display = "";
      } else {
        legacyBtnQuiz.style.display = "none";
      }

      const vocab = d.vocab || [];
      hint.textContent = tr("quizHint", vocab.length);

      quizDiv.innerHTML = "";
      if(!vocab.length){
        quizDiv.innerHTML = `<div class='muted'>${tr("noVocab")}</div>`;
        return;
      }

      const q = pickQuestion(vocab);
      if(!q){
        quizDiv.innerHTML = "<div class='muted'>í€´ì¦ˆë¥¼ ë§Œë“¤ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ko/mn ê°’ í™•ì¸)</div>";
        return;
      }

      const box = document.createElement("div");
      box.className = "qbox";

      const head = document.createElement("div");
      head.innerHTML = `<div class="muted small">${tr("qLabel")}</div>
                        <div style="font-weight:900;font-size:18px;margin-top:6px;">${q.prompt}</div>`;
      box.appendChild(head);

      const choicesWrap = document.createElement("div");
      choicesWrap.className = "choices";

      const result = document.createElement("div");
      result.className = "result";
      result.style.display = "none";

      function lock(){
        [...choicesWrap.querySelectorAll("button")].forEach(b=>b.disabled=true);
      }

      q.choices.forEach(ch=>{
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "choice";
        btn.textContent = ch;

        btn.addEventListener("click", ()=>{
          const ok = ch === q.correct;
          result.style.display = "";
          result.classList.remove("ok","bad");
          result.classList.add(ok ? "ok" : "bad");
          result.innerHTML = ok
            ? `<b>${tr("correct")}</b> <span class="muted small">(${tr("answer")}: ${q.correct})</span>`
            : `<b>${tr("wrong")}</b> <span class="muted small">${tr("answer")}: ${q.correct}</span>`;
          lock();
        });

        choicesWrap.appendChild(btn);
      });

      box.appendChild(choicesWrap);
      box.appendChild(result);
      quizDiv.appendChild(box);
    }

    async function main(){
      applyTexts();

      document.getElementById("tab-vocab").addEventListener("click", ()=>setActiveTab("vocab"));
      document.getElementById("tab-quiz").addEventListener("click", ()=>setActiveTab("quiz"));
      document.getElementById("tab-grammar").addEventListener("click", ()=>setActiveTab("grammar"));

      document.getElementById("btnLang").addEventListener("click", ()=>{
        const next = (getLang()==="KR") ? "MN" : "KR";
        setLang(next);
        applyTexts();
        if(LESSON){
          renderVocab(LESSON);
          renderGrammar(LESSON);
          renderQuiz(LESSON);
        }
      });

      document.getElementById("btnMode").addEventListener("click", ()=>{
        QUIZ_MODE = (QUIZ_MODE==="KO2MN") ? "MN2KO" : "KO2MN";
        applyTexts();
        if(LESSON) renderQuiz(LESSON);
      });

      document.getElementById("btnNew").addEventListener("click", ()=>{
        if(LESSON) renderQuiz(LESSON);
      });

      const dataPath = getParam("data");
      const title = document.getElementById("title");
      const subtitle = document.getElementById("subtitle");
      const status = document.getElementById("status");

      if(!dataPath){
        subtitle.textContent = "data ê²½ë¡œê°€ ì—†ìŠµë‹ˆë‹¤.";
        status.textContent = "ì˜¤ë¥˜";
        return;
      }

      try{
  // âœ… ìƒëŒ€ê²½ë¡œ/ì ˆëŒ€URL ëª¨ë‘ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
  const dataUrl = new URL(dataPath, location.href).toString();

  // í™”ë©´ì— ì§€ê¸ˆ ì½ìœ¼ë ¤ëŠ” ì£¼ì†Œë¥¼ í‘œì‹œ(ë¬¸ì œ ì§„ë‹¨ ê°€ëŠ¥)
  document.getElementById("status").textContent = "Loading...";
  document.getElementById("subtitle").textContent = dataUrl;

  const res = await fetch(dataUrl, { cache:"no-store" });
  if(!res.ok) throw new Error("ë ˆìŠ¨ JSON ë¡œë“œ ì‹¤íŒ¨: " + res.status + " / " + dataUrl);

  const d = await res.json();
  LESSON = d;

  title.textContent = `${d.level || ""} ${d.lesson || ""} Â· ${d.title_kr || ""}`.trim();
  subtitle.textContent = d.title_mn || "";
  status.textContent = tr("loaded");

  renderVocab(d);
  renderGrammar(d);
  renderQuiz(d);

} catch(err){
  // âœ… ì—ëŸ¬ë¥¼ í™”ë©´ì— â€œì •í™•íˆâ€ ë³´ì—¬ì¤Œ (ì½˜ì†” ì•ˆ ë´ë„ ë¨)
  subtitle.textContent = "ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜: " + (err.message || err);
  status.textContent = "ì˜¤ë¥˜";
  console.log(err);
}
    }

    main();
  </script>
</body>
</html>
