<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="theme-color" content="#0b1220" />
  <title>TOPIK II Level</title>
  <style>
    :root{
      --bg:#0b1220;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--line:#243044;
      --accent:#60a5fa;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Arial,sans-serif;
      background:linear-gradient(180deg,#050814,var(--bg));
      color:var(--text);
      min-height:100svh;
    }
    a{color:inherit;text-decoration:none}
    .topbar{
      position:sticky;top:0;z-index:10;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:12px 16px;background:rgba(5,8,20,.75);backdrop-filter:blur(10px);
      border-bottom:1px solid var(--line);
    }
    .brand{display:flex;align-items:center;gap:10px;font-weight:800}
    .dot{width:10px;height:10px;border-radius:999px;background:var(--accent)}
    .container{max-width:980px;margin:0 auto;padding:16px}
    .card{
      background:rgba(17,24,39,.9);
      border:1px solid var(--line);
      border-radius:16px;
      padding:16px;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .muted{color:var(--muted);line-height:1.6}
    .btn{
      padding:10px 12px;border-radius:12px;border:1px solid var(--line);
      background:#0b1020;color:var(--text);cursor:pointer;display:inline-block
    }
    .btnRow{display:flex;gap:8px;flex-wrap:wrap}
    .bar{height:1px;background:var(--line);margin:12px 0}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px}
    .box{border:1px solid var(--line);background:#0b1020;border-radius:14px;padding:12px}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand"><span class="dot"></span><a href="../index.html" id="homeLink">Korean Quiz</a></div>
    <div class="btnRow">
      <a class="btn" href="./index.html" id="btnTopik2">TOPIK II</a>
      <a class="btn" href="../index.html" id="btnDashboard">대시보드</a>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h1 style="margin:0 0 6px;" id="title">TOPIK II</h1>
      <div class="muted" id="sub">준비 중...</div>
      <div class="bar"></div>

      <div class="box">
        <div style="font-weight:900;margin-bottom:8px;">데이터 로드 주소</div>
        <div class="mono" id="dataUrl"></div>
        <div class="muted" style="margin-top:10px;">
          이 페이지는 “자리(틀)”입니다.<br/>
          나중에 <span class="mono">/data/topik2/{cat}/levelXX.json</span>을 채우면 자동으로 연결됩니다.
        </div>
      </div>

      <div id="msg" class="muted" style="margin-top:12px;"></div>
    </section>
  </main>

  <script>
    // ===== repo base 자동 인식 (/korean-quiz) =====
    function getRepoBase(){
      const p = location.pathname.split("/").filter(Boolean);
      return p.length ? ("/" + p[0]) : "";
    }
    const REPO_BASE = getRepoBase();

    function getParam(k){
      const u = new URL(location.href);
      return u.searchParams.get(k) || "";
    }

    // ===== 파라미터 유지(name/klass/token/lang) =====
    const passthrough = new URLSearchParams();
    ["name","klass","token","lang"].forEach(k=>{
      const v = getParam(k);
      if(v) passthrough.set(k, v);
    });
    // lang이 없으면 localStorage 값으로 보완(대시보드 정책과 동일)
    if(!passthrough.get("lang")){
      const v = localStorage.getItem("kq_lang_v1");
      if(v === "ko" || v === "mn") passthrough.set("lang", v);
    }

    const qs = passthrough.toString();
    const withQS = (url)=>{
      if(!qs) return url;
      return url + (url.includes("?") ? "&" : "?") + qs;
    };

    // 링크에 파라미터 유지
    document.getElementById("btnDashboard").href = withQS(REPO_BASE + "/index.html");
    document.getElementById("btnTopik2").href = withQS(REPO_BASE + "/topik2/index.html");
    document.getElementById("homeLink").href = withQS(REPO_BASE + "/index.html");

    // ===== 현재 선택 정보 =====
    const cat = getParam("cat") || "vocab";
    const levelNum = parseInt(getParam("level") || "1", 10);
    const level = String(isNaN(levelNum) ? 1 : levelNum).padStart(2, "0");

    const pretty = ({
      vocab:"어휘",
      grammar:"문법",
      reading_type:"읽기 유형",
      listening_type:"듣기 유형",
      reading_mock:"읽기 모의평가",
      listening_mock:"듣기 모의평가"
    }[cat] || cat);
// ===== ✅ SPECIAL: TOPIK2 어휘 Level 1/2 → flashcards로 바로 이동 =====
if (cat === "vocab" && (level === "01" || level === "02")) {
  const file = (level === "01")
    ? "/data/topik2/vocab/level01_attitude.json"
    : "/data/topik2/vocab/level02_connectors.json";

  const url = new URL(REPO_BASE + "/topik2/flashcards.html", location.origin);
  url.searchParams.set("file", file);

  // 파라미터 유지
  passthrough.forEach((v, k) => url.searchParams.set(k, v));

  location.replace(url.toString());
  } else {
      // ===== 기본(기존) 동작: data/topik2/{cat}/levelXX.json 존재 여부만 확인 =====
      document.getElementById("title").textContent = `TOPIK II · ${pretty} · Level ${parseInt(level,10)}`;
      document.getElementById("sub").textContent = "이 레벨은 JSON 데이터가 준비되면 자동으로 활성화됩니다.";

      const jsonPath = REPO_BASE + `/data/topik2/${encodeURIComponent(cat)}/level${level}.json`;
      document.getElementById("dataUrl").textContent = jsonPath.replace(REPO_BASE, "..");

      fetch(jsonPath, { cache:"no-store" })
        .then(r=>{
          if(!r.ok) throw new Error("HTTP " + r.status);
          return r.json();
        })
        .then(_=>{
          document.getElementById("msg").textContent = "✅ 데이터가 존재합니다. (다음 단계: 이 데이터를 퀴즈 화면으로 연결)";
        })
        .catch(_=>{
          document.getElementById("msg").textContent = "⏳ 아직 데이터 파일이 없습니다. (정상) 나중에 JSON을 만들면 자동으로 연결됩니다.";
        });
    }
  </script>
</body>
</html>
