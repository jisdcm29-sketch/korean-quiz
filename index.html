<!DOCTYPE html>
<html lang="mn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>“Æ–≥–∏–π–Ω —Å–∞–Ω–≥–∏–π–Ω —Ç–µ—Å—Ç (–°–∫—Ä–∏–Ω—à–æ—Ç —Ö—É–≤–∏–ª–±–∞—Ä)</title>
  <style>
    :root{
      --bg:#f0f4f8; --card:#fff; --primary:#2d6cdf; --primary2:#1f4ea5;
      --text:#223047; --muted:#6a7a8e; --line:#d9e4f5;
      --warnbg:#fff5f5; --warnline:#feb2b2;
    }
    *{box-sizing:border-box}
    body{margin:0; padding:20px; font-family:Arial,sans-serif; background:var(--bg); color:var(--text); text-align:center;}
    .container{max-width:560px; margin:0 auto; background:var(--card); padding:26px; border-radius:20px; border:1px solid var(--line); box-shadow:0 10px 20px rgba(0,0,0,0.08);}
    h2{margin:0; font-size:22px; color:#1f2f45;}
    .sub{margin:10px 0 0; color:var(--muted); font-size:15px;}
    input{width:92%; padding:14px; margin:14px 0 10px; border:2px solid #e0e0e0; border-radius:12px; font-size:18px; text-align:center; outline:none;}
    input:focus{border-color:#b7cdfd; box-shadow:0 0 0 4px rgba(45,108,223,0.12);}
    button{width:100%; background:var(--primary); color:#fff; padding:15px 16px; border:none; border-radius:12px; cursor:pointer; font-size:18px; font-weight:900; transition:.2s;}
    button:hover{background:var(--primary2);}
    .choice-btn{display:block; width:100%; margin:12px 0; background:#fff; color:var(--text); border:2px solid var(--primary); border-radius:12px; padding:15px; font-size:18px; font-weight:900; cursor:pointer; transition:.15s;}
    .choice-btn:hover{background:var(--primary); color:#fff;}
    .row{display:flex; gap:10px; margin-top:12px;}
    .row button{width:50%;}
    .btn-gray{background:#eef2f7; color:#2c3e50; border:1px solid #d7dee7;}
    .btn-gray:hover{background:#e2e8f0;}
    .btn-orange{background:#e67e22;}
    .btn-orange:hover{background:#cf6b12;}
    .tag{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #d7dee7; background:#f6f9ff; font-size:12px; color:#2c3e50; font-weight:900;}
    .instruction{margin:14px 0 12px; background:#eef2f7; border-radius:10px; padding:10px; color:#4b5b6f; font-size:14px; line-height:1.35;}
    .qtext{font-size:34px; font-weight:1000; margin:16px 0 10px; color:#1e2f44; word-break:break-word;}
    .meta{color:var(--muted); font-size:13px; margin-top:8px;}
    .box-warn{text-align:left; margin-top:14px; background:var(--warnbg); border:1px solid var(--warnline); border-radius:12px; padding:12px; color:#7a1f1f; font-size:14px; line-height:1.45;}
    .wrong-list{text-align:left; background:var(--warnbg); padding:15px; border-radius:12px; margin:18px 0; border:1px solid var(--warnline); max-height:340px; overflow-y:auto;}
    .wrong-item{margin-bottom:10px; border-bottom:1px dashed var(--warnline); padding-bottom:8px; font-size:15px;}
    .score-text{font-size:28px; font-weight:1000; color:#d33; margin:10px 0;}
    .note{margin-top:14px; background:#eaf3ff; border:1px solid #b9d7ff; border-radius:12px; padding:12px; color:#0f3f7a; font-weight:1000; line-height:1.45;}
    .result-card{
      text-align:left;
      border:1px solid var(--line);
      border-radius:16px;
      padding:16px;
      background:#fff;
    }
    .result-card .title{font-size:18px; font-weight:1000; color:#1f2f45; margin-bottom:10px;}
    .result-card .line{font-size:17px; line-height:1.65; color:#223047; font-weight:900;}
    .result-card .small{font-size:14px; color:var(--muted); margin-top:10px; font-weight:1000;}

    /* ‚úÖ Ï∫°Ï≤ò Î™®Îìú: Î∂àÌïÑÏöîÌïú Î≤ÑÌäº Ïà®Í∏∞Í≥† Ïπ¥Îìú ÌÅ¨Í≤å */
    .shotmode .hide-on-shot{display:none !important;}
    .shotmode .container{max-width:620px;}
    .shotmode .result-card{border:2px solid #b9d7ff; padding:18px;}
    .shotmode .score-text{font-size:34px;}
    .shotmode body{background:#ffffff;}
    #quiz-section,#review-section,#result-section,#error-section{display:none;}
  </style>
</head>
<body>
  <div class="container">
    <div id="start-section">
      <h2>“Æ–≥—Å–∏–π–Ω —Å–∞–Ω–≥–∏–π–Ω —Ç–µ—Å—Ç</h2>
      <p class="sub">–ù—ç—Ä—ç—ç –æ—Ä—É—É–ª–∞–∞–¥ —ç—Ö—ç–ª–Ω—ç “Ø“Ø.</p>
      <input id="userName" type="text" placeholder="–¢–∞–Ω—ã –Ω—ç—Ä" autocomplete="name" />
      <button onclick="startQuiz()">–≠—Ö–ª—ç—Ö</button>
      <div class="meta" id="vocabCount"></div>
    </div>

    <div id="quiz-section">
      <h3 id="question-number" style="color:var(--primary); margin:0;"></h3>
      <div id="question-instruction" class="instruction"></div>
      <div id="question-text" class="qtext"></div>
      <div id="choices"></div>
      <div class="row hide-on-shot">
        <button class="btn-gray" onclick="goHome()">–≠—Ö–ª—ç–ª</button>
        <button class="btn-gray" onclick="restartAttempt()">–î–∞—Ö–∏–Ω —ç—Ö–ª—ç—Ö</button>
      </div>
    </div>

    <div id="review-section">
      <h2 style="color:#e67e22;">–ê–ª–¥–∞–∞–≥–∞–∞ —à–∞–ª–≥–∞–Ω–∞ —É—É</h2>
      <p class="sub">–≠–¥–≥—ç—ç—Ä “Ø–≥—Å–∏–π–≥ —Ü—ç—ç–∂–ª—ç—ç–¥ –¥–∞—Ö–∏–Ω –æ—Ä–æ–ª–¥–æ–Ω–æ —É—É.</p>
      <div id="wrong-answers-container" class="wrong-list"></div>
      <button class="btn-orange hide-on-shot" onclick="retryQuiz()">–û–π–ª–≥–æ–ª–æ–æ, –¥–∞—Ö–∏–Ω —ç—Ö–ª—ç—Ö</button>
    </div>

    <!-- ‚úÖ Í≤∞Í≥º ÌôîÎ©¥(Ïä§ÌÅ¨Î¶∞ÏÉ∑ Ï†ÑÏö©) -->
    <div id="result-section">
      <h2 id="result-title" style="color:#1f8a4b;">üéâ –¢—ç–Ω—Ü–ª—ç—ç!</h2>

      <div id="captureTarget" class="result-card">
        <div class="title">“Æ—Ä –¥“Ø–Ω</div>
        <div class="line" id="resultLineName"></div>
        <div class="line" id="resultLineScore"></div>
        <div class="line" id="resultLineAttempts"></div>
        <div class="small" style="margin-top:14px;">
          <b style="color:#0f3f7a;">–≠–Ω—ç –¥—ç–ª–≥—ç—Ü–∏–π–≥ —Å–∫—Ä–∏–Ω—à–æ—Ç</b> —Ö–∏–π–∂ –±–∞–≥—à —Ä—É—É–≥–∞–∞ –∏–ª–≥—ç—ç–Ω—ç “Ø“Ø!
        </div>
      </div>

      <div class="note">
        1) –î–æ–æ—Ä—Ö <b>‚Äúüì∏ –°–∫—Ä–∏–Ω—à–æ—Ç –≥–æ—Ä–∏–º‚Äù</b> —Ç–æ–≤—á–∏–π–≥ –¥–∞—Ä–Ω–∞ —É—É.<br>
        2) –î—ç–ª–≥—ç—Ü–∏–π–Ω <b>—Å–∫—Ä–∏–Ω—à–æ—Ç</b> –∞–≤–∞–∞–¥ –±–∞–≥—à–¥–∞–∞ —è–≤—É—É–ª–Ω–∞ —É—É.
      </div>

      <!-- ‚úÖ Îã§Ïö¥Î°úÎìú/Í≥µÏú† ÏÇ≠Ï†ú, Ï∫°Ï≤òÎ™®ÎìúÎßå -->
      <div class="row hide-on-shot">
        <button onclick="enterShotMode()">üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç –≥–æ—Ä–∏–º</button>
        <button class="btn-gray" onclick="exitShotMode()">–ì–∞—Ä–∞—Ö</button>
      </div>

      <div class="row hide-on-shot">
        <button class="btn-gray" onclick="restartAttempt()">–î–∞—Ö–∏–Ω —Ö–∏–π—Ö</button>
        <button class="btn-gray" onclick="resetAll()">–®–∏–Ω—ç –Ω—ç—Ä—ç—ç—Ä</button>
      </div>

      <div class="meta hide-on-shot" id="shotHelp"></div>
    </div>
  </div>

<script>
  /***************
   * ‚úÖ ÏòàÏãú Îç∞Ïù¥ÌÑ∞(Ïó¨Í∏∞Ïóê 1Í≥º/2Í≥º rawWordsÎ•º ÎÑ£Ïñ¥ Ïì∞Î©¥ Îê©ÎãàÎã§)
   ***************/
  const rawWords = [
    { kor: "ÎßàÏãúÎã§", mon: "—É—É—Ö", pos: "v" },
    { kor: "Î®πÎã§", mon: "–∏–¥—ç—Ö", pos: "v" },
    { kor: "ÌïôÍµê", mon: "—Å—É—Ä–≥—É—É–ª—å", pos: "n" },
    { kor: "Ï±Ö", mon: "–Ω–æ–º", pos: "n" }
  ];

  const PASS_SCORE = 80;
  const MAX_FAILS_BEFORE_PASS = 5;
  const STORE_KEY = "attempts_shot_mode";

  let attempts = localStorage.getItem(STORE_KEY) ? parseInt(localStorage.getItem(STORE_KEY), 10) : 0;
  let wordList = [], currentIdx = 0, score = 0, wrongWords = [], name = "";

  document.getElementById("vocabCount").innerText = `“Æ–≥–∏–π–Ω —Ç–æ–æ: ${rawWords.length}`;

  function shuffle(arr){
    const a = arr.slice();
    for (let i=a.length-1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function buildChoices(correct, dir, pos){
    const pickVal = (w) => (dir === "K2M" ? w.mon : w.kor);
    const samePos = rawWords.filter(w => w.pos === pos).map(pickVal).filter(x => x && x !== correct);
    const anyPos  = rawWords.map(pickVal).filter(x => x && x !== correct);
    let candidates = shuffle(samePos).concat(shuffle(anyPos));

    const distractors = [];
    for (const c of candidates){
      if (c !== correct && !distractors.includes(c)) distractors.push(c);
      if (distractors.length >= 3) break;
    }

    let choices = Array.from(new Set([correct, ...distractors]));
    if (choices.length < 4){
      for (const c of shuffle(anyPos)){
        if (!choices.includes(c)) choices.push(c);
        if (choices.length >= 4) break;
      }
    }
    while (choices.length < 4) choices.push(correct);

    return shuffle(choices.slice(0,4));
  }

  function prepareQuestions(){
    const shuffled = shuffle(rawWords);
    wordList = shuffled.map(w=>{
      const dir = Math.random() < 0.5 ? "K2M" : "M2K";
      const q = (dir === "K2M") ? w.kor : w.mon;
      const a = (dir === "K2M") ? w.mon : w.kor;
      return { dir, pos:w.pos, q, a, kor:w.kor, mon:w.mon, choices: buildChoices(a, dir, w.pos) };
    });
  }

  function showOnly(id){
    ["start-section","quiz-section","review-section","result-section"].forEach(s=>{
      document.getElementById(s).style.display = (s === id) ? "block" : "none";
    });
  }

  function startQuiz(){
    exitShotMode();
    name = (document.getElementById("userName").value || "").trim();
    if (!name){ alert("–ù—ç—Ä—ç—ç –æ—Ä—É—É–ª–Ω–∞ —É—É!"); return; }

    currentIdx = 0; score = 0; wrongWords = [];
    prepareQuestions();
    showOnly("quiz-section");
    showQuestion();
  }

  function showQuestion(){
    if (currentIdx >= wordList.length) return finishQuiz();
    const item = wordList[currentIdx];

    document.getElementById("question-number").innerText = `${currentIdx+1} / ${wordList.length}`;

    const qLang = (item.dir === "K2M") ? "–°–æ–ª–æ–Ω–≥–æ—Å" : "–ú–æ–Ω–≥–æ–ª";
    const cLang = (item.dir === "K2M") ? "–ú–æ–Ω–≥–æ–ª" : "–°–æ–ª–æ–Ω–≥–æ—Å";
    document.getElementById("question-instruction").innerHTML =
      `–ê—Å—É—É–ª—Ç: <span class="tag">${qLang}</span> ¬∑ –°–æ–Ω–≥–æ–ª—Ç: <span class="tag">${cLang}</span><br>` +
      (item.dir === "K2M" ? "–ó”©–≤ –ú–æ–Ω–≥–æ–ª –æ—Ä—á—É—É–ª–≥—ã–≥ —Å–æ–Ω–≥–æ–Ω–æ —É—É." : "–ó”©–≤ –°–æ–ª–æ–Ω–≥–æ—Å “Ø–≥–∏–π–≥ —Å–æ–Ω–≥–æ–Ω–æ —É—É.");

    document.getElementById("question-text").innerText = item.q;

    const choicesDiv = document.getElementById("choices");
    choicesDiv.innerHTML = "";
    let locked = false;

    item.choices.forEach(choice=>{
      const btn = document.createElement("button");
      btn.className = "choice-btn";
      btn.innerText = choice;
      btn.onclick = ()=>{
        if (locked) return;
        locked = true;
        if (choice === item.a) score += (100 / wordList.length);
        else wrongWords.push(item);
        currentIdx++;
        showQuestion();
      };
      choicesDiv.appendChild(btn);
    });
  }

  function finishQuiz(){
    attempts++;
    localStorage.setItem(STORE_KEY, String(attempts));
    const finalScore = Math.round(score);

    if (finalScore >= PASS_SCORE || attempts >= MAX_FAILS_BEFORE_PASS){
      const forced = (attempts >= MAX_FAILS_BEFORE_PASS && finalScore < PASS_SCORE);
      document.getElementById("result-title").innerText = forced ? "üí™ –¢—ç–Ω—Ü–ª—ç—ç!" : "üéâ –¢—ç–Ω—Ü–ª—ç—ç!";

      document.getElementById("resultLineName").innerHTML = `–ù—ç—Ä: <b>${escapeHtml(name)}</b>`;
      document.getElementById("resultLineScore").innerHTML = `–î“Ø–Ω: <span class="score-text">${finalScore} –æ–Ω–æ–æ</span>`;
      document.getElementById("resultLineAttempts").innerHTML = `–û—Ä–æ–ª–¥–ª–æ–≥–æ: <b>${attempts}</b>`;

      localStorage.removeItem(STORE_KEY);
      attempts = 0;

      // ‚úÖ Ïä§ÌÅ¨Î¶∞ÏÉ∑ ÏïàÎÇ¥(Í∏∞Ï¢ÖÎ≥Ñ)
      document.getElementById("shotHelp").innerHTML =
        `iPhone: <b>Side + Volume Up</b> (—ç—Å–≤—ç–ª Home + Power)<br>` +
        `Android: <b>Power + Volume Down</b>`;

      showOnly("result-section");
    } else {
      showReview(finalScore);
    }
  }

  function showReview(finalScore){
    const container = document.getElementById("wrong-answers-container");
    container.innerHTML = `<div style="font-weight:1000; color:#d33;">–¢–∞–Ω—ã –¥“Ø–Ω: ${finalScore} –æ–Ω–æ–æ</div>`;
    wrongWords.forEach(w=>{
      const div = document.createElement("div");
      div.className = "wrong-item";
      div.innerHTML = `‚ùì <b>${escapeHtml(w.q)}</b> ‚Üí ‚úÖ <b>${escapeHtml(w.a)}</b>`;
      container.appendChild(div);
    });
    showOnly("review-section");
  }

  function retryQuiz(){
    exitShotMode();
    currentIdx = 0; score = 0; wrongWords = [];
    prepareQuestions();
    showOnly("quiz-section");
    showQuestion();
  }

  function restartAttempt(){
    exitShotMode();
    currentIdx = 0; score = 0; wrongWords = [];
    prepareQuestions();
    showOnly("quiz-section");
    showQuestion();
  }

  function resetAll(){
    exitShotMode();
    localStorage.removeItem(STORE_KEY);
    attempts = 0; currentIdx = 0; score = 0; wrongWords = []; name = "";
    document.getElementById("userName").value = "";
    showOnly("start-section");
  }

  // ‚úÖ Ïä§ÌÅ¨Î¶∞ÏÉ∑ Î™®Îìú(Ï∫°Ï≤òÌïòÍ∏∞ Ï¢ãÏùÄ ÌôîÎ©¥ÏúºÎ°ú Î≥ÄÍ≤Ω)
  function enterShotMode(){
    document.documentElement.classList.add("shotmode");
    document.getElementById("shotHelp").innerHTML =
      `–û–¥–æ–æ <b>—Å–∫—Ä–∏–Ω—à–æ—Ç</b> –∞–≤–∞–∞–¥ –±–∞–≥—à–¥–∞–∞ —è–≤—É—É–ª–Ω–∞ —É—É.`;
    // Îß® ÏúÑÎ°ú Ïä§ÌÅ¨Î°§(ÏïÑÏù¥Ìè∞ÏóêÏÑú Î≤ÑÌäºÏù¥ ÏûòÎ¶¨Î©¥ Ïïà Îê®)
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function exitShotMode(){
    document.documentElement.classList.remove("shotmode");
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");
  }
</script>
</body>
</html>
